<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<title>ğŸ¡ ×¨×•×œ×˜×” ××©×•×ª×¤×ª - ×§×•×“ ××ª×•×§×Ÿ</title>
<style>
body {
  font-family: Arial, sans-serif;
  background: #f5f5f5;
  text-align: center;
  padding: 20px;
  max-width: 800px;
  margin: 0 auto;
}

input, button {
  font-size: 16px;
  padding: 10px;
  margin: 5px;
  border: 2px solid #ddd;
  border-radius: 5px;
}

button {
  background: #4CAF50;
  color: white;
  border: none;
  cursor: pointer;
}

button:hover {
  background: #45a049;
}

button:disabled {
  background: #cccccc;
  cursor: not-allowed;
}

#wheel {
  margin: 20px auto;
  width: 300px;
  height: 300px;
  border-radius: 50%;
  border: 5px solid #333;
  position: relative;
  transition: transform 3s ease-out;
  overflow: hidden;
}

.slice {
  position: absolute;
  width: 50%;
  height: 50%;
  top: 50%;
  left: 50%;
  transform-origin: 0% 0%;
  display: flex;
  justify-content: center;
  align-items: center;
  border: 1px solid #ccc;
  font-size: 14px;
  font-weight: bold;
  word-break: break-word;
  color: #333;
}

#pointer {
  width: 0;
  height: 0;
  margin: 20px auto;
  border-left: 15px solid transparent;
  border-right: 15px solid transparent;
  border-bottom: 25px solid red;
}

#result {
  font-size: 24px;
  margin-top: 15px;
  font-weight: bold;
  color: #2e7d32;
}

#list {
  margin: 15px 0;
  font-weight: bold;
  font-size: 16px;
}

#debug {
  background: #f9f9f9;
  border: 1px solid #ddd;
  padding: 15px;
  margin: 20px 0;
  border-radius: 5px;
  text-align: left;
  font-family: 'Courier New', monospace;
  font-size: 14px;
  max-height: 200px;
  overflow-y: auto;
}

.status {
  padding: 10px;
  margin: 10px;
  border-radius: 5px;
  font-weight: bold;
}

.error {
  background-color: #ffebee;
  color: #c62828;
  border: 2px solid #ef5350;
}

.success {
  background-color: #e8f5e8;
  color: #2e7d32;
  border: 2px solid #66bb6a;
}

.warning {
  background-color: #fff8e1;
  color: #f57f17;
  border: 2px solid #ffca28;
}

.connecting {
  background-color: #e3f2fd;
  color: #1976d2;
  border: 2px solid #42a5f5;
}
</style>
</head>

<body>

<h1>ğŸ¡ ×¨×•×œ×˜×” ××©×•×ª×¤×ª (Firebase) - ×’×¨×¡×” ××ª×•×§× ×ª</h1>

<div>
  <input id="nameInput" placeholder="×”×›× ×¡ ×©×" onkeydown="if(event.key==='Enter') addName()">
  <button onclick="addName()" id="addBtn">×”×•×¡×£ ×©×</button>
  <button onclick="reset()" id="resetBtn">× ×§×” ×”×›×œ</button>
</div>

<div id="status" class="status connecting">××ª×—×™×œ...</div>
<div id="debug"><strong>×œ×•×’ ×“×™××’× ×•×¡×˜×™×§×”:</strong><br></div>

<div id="list">××©×ª×ª×¤×™×: ××™×Ÿ</div>

<div id="pointer"></div>
<div id="wheel"></div>

<button onclick="spin()" id="spinBtn">ğŸ² ×¡×•×‘×‘ ××ª ×”×¨×•×œ×˜×”!</button>
<div id="result"></div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

// ×ª×¦×•×¨×ª Firebase - ×¢× databaseURL ××¤×•×¨×©
const firebaseConfig = {
  apiKey: "AIzaSyBWc81acgd-9tVi4wLlAw_PXdEgR0n81qU",
  authDomain: "trip-9506c.firebaseapp.com",
  projectId: "trip-9506c",
  storageBucket: "trip-9506c.firebasestorage.app",
  messagingSenderId: "813393240812",
  appId: "1:813393240812:web:929bed95de2c48d5e43bc9",
  databaseURL: "https://trip-9506c-default-rtdb.firebaseio.com/"
};

let app, db, namesRef;
let names = [];
let rotation = 0;
let isConnected = false;

// ×¤×•× ×§×¦×™×•×ª ×¢×–×¨
function log(message, type = "info") {
  const now = new Date().toLocaleTimeString('he-IL');
  const debugDiv = document.getElementById("debug");
  const prefix = type === "error" ? "âŒ" : type === "success" ? "âœ…" : type === "warning" ? "âš ï¸" : "â„¹ï¸";
  debugDiv.innerHTML += `<div>[${now}] ${prefix} ${message}</div>`;
  debugDiv.scrollTop = debugDiv.scrollHeight;
  console.log(`[Firebase Debug] ${message}`);
}

function showStatus(message, type) {
  const statusDiv = document.getElementById("status");
  statusDiv.textContent = message;
  statusDiv.className = `status ${type}`;
  log(message, type);
}

function updateButtons() {
  const addBtn = document.getElementById("addBtn");
  const resetBtn = document.getElementById("resetBtn");
  const spinBtn = document.getElementById("spinBtn");
  
  addBtn.disabled = !isConnected;
  resetBtn.disabled = !isConnected;
  spinBtn.disabled = !isConnected || names.length === 0;
}

// ××ª×—×•×œ Firebase
try {
  log("××ª×—×™×œ ××ª×—×•×œ Firebase...");
  
  app = initializeApp(firebaseConfig);
  log("Firebase app ××•×ª×—×œ ×‘×”×¦×œ×—×”");
  
  db = getDatabase(app);
  log("××ª×—×‘×¨ ×œ××¡×“ × ×ª×•× ×™×...");
  
  namesRef = ref(db, "names");
  log("×™×¦×¨ reference ×œ× ×ª×™×‘ 'names'");
  
  showStatus("××ª×—×‘×¨ ×œ-Firebase...", "connecting");
  
  // ×××–×™×Ÿ ×œ×©×™× ×•×™×™× ×‘×–××Ÿ ×××ª
  onValue(namesRef, (snapshot) => {
    try {
      log("×§×™×‘×œ×ª×™ ×¢×“×›×•×Ÿ ×-Firebase");
      const data = snapshot.val();
      names = data ? Object.values(data) : [];
      
      log(`× ×˜×¢× ×• ${names.length} ×©××•×ª: ${names.join(", ") || "××™×Ÿ"}`);
      
      if (!isConnected) {
        isConnected = true;
        showStatus("××—×•×‘×¨ ×‘×”×¦×œ×—×” ×œ-Firebase! ğŸ‰", "success");
      }
      
      render();
      updateButtons();
      
    } catch (error) {
      log(`×©×’×™××” ×‘×¢×™×‘×•×“ × ×ª×•× ×™×: ${error.message}`, "error");
      showStatus("×©×’×™××” ×‘×¢×™×‘×•×“ × ×ª×•× ×™× ×-Firebase", "error");
    }
  }, (error) => {
    log(`×©×’×™××” ×‘×—×™×‘×•×¨ ×œ-Firebase: ${error.code} - ${error.message}`, "error");
    showStatus(`×©×’×™××” ×‘×—×™×‘×•×¨: ${error.message}`, "error");
    isConnected = false;
    updateButtons();
  });
  
} catch (error) {
  log(`×©×’×™××” ×§×¨×™×˜×™×ª ×‘××ª×—×•×œ: ${error.message}`, "error");
  showStatus("×©×’×™××” ×§×¨×™×˜×™×ª ×‘××ª×—×•×œ Firebase", "error");
}

// ×¤×•× ×§×¦×™×™×ª ×”×•×¡×¤×ª ×©×
window.addName = function() {
  const input = document.getElementById("nameInput");
  const name = input.value.trim();
  
  log(`× ×™×¡×™×•×Ÿ ×”×•×¡×¤×ª ×©×: "${name}"`);
  
  if (!name) {
    showStatus("×× × ×”×›× ×¡ ×©× ×ª×§×™×Ÿ", "error");
    return;
  }
  
  if (names.includes(name)) {
    showStatus(`×”×©× "${name}" ×›×‘×¨ ×§×™×™× ×‘×¨×©×™××”`, "warning");
    input.focus();
    return;
  }
  
  if (!isConnected) {
    showStatus("××™×Ÿ ×—×™×‘×•×¨ ×œ-Firebase", "error");
    return;
  }
  
  try {
    log(`×©×•×œ×— ×©× "${name}" ×œ-Firebase...`);
    
    push(namesRef, name)
      .then(() => {
        log(`×”×©× "${name}" × ×•×¡×£ ×‘×”×¦×œ×—×” ×œ-Firebase`, "success");
        showStatus(`×”×©× "${name}" × ×•×¡×£ ×‘×”×¦×œ×—×”! âœ…`, "success");
        input.value = "";
        input.focus();
      })
      .catch(error => {
        log(`×©×’×™××” ×‘×”×•×¡×¤×ª ×©× ×œ-Firebase: ${error.code} - ${error.message}`, "error");
        showStatus(`×©×’×™××” ×‘×”×•×¡×¤×ª ×”×©×: ${error.message}`, "error");
      });
      
  } catch (error) {
    log(`×©×’×™××” ×‘×¤×¢×•×œ×ª ×”×”×•×¡×¤×”: ${error.message}`, "error");
    showStatus("×©×’×™××” ×‘×”×•×¡×¤×ª ×”×©×", "error");
  }
};

// ×¤×•× ×§×¦×™×™×ª ××™×¤×•×¡
window.reset = function() {
  if (!isConnected) {
    showStatus("××™×Ÿ ×—×™×‘×•×¨ ×œ-Firebase", "error");
    return;
  }
  
  if (names.length === 0) {
    showStatus("×”×¨×©×™××” ×›×‘×¨ ×¨×™×§×”", "warning");
    return;
  }
  
  if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ${names.length} ×”×©××•×ª?`)) {
    log("×”×‘×™×˜×•×œ × ××—×§×” ×¢×œ ×™×“×™ ×”××©×ª××©");
    return;
  }
  
  try {
    log("××•×—×§ ××ª ×›×œ ×”×©××•×ª ×-Firebase...");
    
    remove(namesRef)
      .then(() => {
        log("×›×œ ×”×©××•×ª × ××—×§×• ×‘×”×¦×œ×—×” ×-Firebase", "success");
        showStatus("×›×œ ×”×©××•×ª × ××—×§×• ×‘×”×¦×œ×—×”! ğŸ—‘ï¸", "success");
        document.getElementById("result").innerText = "";
      })
      .catch(error => {
        log(`×©×’×™××” ×‘××—×™×§×ª ×”×©××•×ª: ${error.code} - ${error.message}`, "error");
        showStatus(`×©×’×™××” ×‘××—×™×§×”: ${error.message}`, "error");
      });
      
  } catch (error) {
    log(`×©×’×™××” ×‘×¤×¢×•×œ×ª ×”××—×™×§×”: ${error.message}`, "error");
    showStatus("×©×’×™××” ×‘××—×™×§×”", "error");
  }
};

// ×¤×•× ×§×¦×™×™×ª ×¨×™× ×“×•×¨
function render() {
  const wheel = document.getElementById("wheel");
  const listDiv = document.getElementById("list");

  // ×¢×“×›×•×Ÿ ×¨×©×™××ª ×”××©×ª×ª×¤×™×
  listDiv.innerHTML = `××©×ª×ª×¤×™× (${names.length}): ` + (names.length ? names.join(", ") : "××™×Ÿ");

  // × ×™×§×•×™ ×”×¨×•×œ×˜×”
  wheel.innerHTML = "";
  
  if (names.length === 0) {
    wheel.style.background = "#f0f0f0";
    return;
  }

  wheel.style.background = "white";
  const angle = 360 / names.length;

  names.forEach((name, i) => {
    const slice = document.createElement("div");
    slice.className = "slice";
    slice.style.transform = `rotate(${i * angle}deg)`;
    slice.style.background = `hsl(${(i * 360 / names.length + 20) % 360}, 70%, 85%)`;
    slice.innerText = name;
    wheel.appendChild(slice);
  });
  
  log(`×¨×•×œ×˜×” ×¢×•×“×›× ×” ×¢× ${names.length} ×©××•×ª`);
}

// ×¤×•× ×§×¦×™×™×ª ×¡×™×‘×•×‘
window.spin = function() {
  if (!isConnected) {
    showStatus("××™×Ÿ ×—×™×‘×•×¨ ×œ-Firebase", "error");
    return;
  }
  
  if (names.length === 0) {
    showStatus("××™×Ÿ ××©×ª×ª×¤×™× ×œ×¨×•×œ×˜×”! ×”×•×¡×£ ×©××•×ª ×§×•×“×", "warning");
    return;
  }

  log(`××¡×•×‘×‘ ××ª ×”×¨×•×œ×˜×” ×¢× ${names.length} ××©×ª×ª×¤×™×`);
  
  // ××—×¡×•× ×›×¤×œ×”
  const spinBtn = document.getElementById("spinBtn");
  spinBtn.disabled = true;
  spinBtn.innerText = "ğŸ² ××¡×•×‘×‘...";
  
  const extra = Math.floor(Math.random() * 360) + 720; // ×œ×¤×—×•×ª 2 ×¡×™×‘×•×‘×™×
  rotation += extra;
  
  log(`×¡×™×‘×•×‘: ${extra} ××¢×œ×•×ª (×¡×”"×›: ${rotation})`);
  
  document.getElementById("wheel").style.transform = `rotate(${rotation}deg)`;

  const angle = 360 / names.length;
  const normalizedRotation = (360 - rotation % 360) % 360;
  const index = Math.floor(normalizedRotation / angle);
  const winner = names[index];
  
  log(`×—×™×©×•×‘ ×–×•×›×”: ×–×•×•×™×ª=${angle}, ×¡×™×‘×•×‘ ×× ×•×¨××œ=${normalizedRotation}, ××™× ×“×§×¡=${index}, ×–×•×›×”="${winner}"`);

  setTimeout(() => {
    document.getElementById("result").innerText = `ğŸ‰ ×”×–×•×›×” ×”×•×: ${winner}!`;
    spinBtn.disabled = false;
    spinBtn.innerText = "ğŸ² ×¡×•×‘×‘ ××ª ×”×¨×•×œ×˜×”!";
    log(`×”×–×•×›×” × ×‘×—×¨: "${winner}"`, "success");
  }, 3000);
};

// ××ª×—×•×œ ×¨××©×•× ×™
updateButtons();
log("×”×§×•×“ × ×˜×¢×Ÿ ×‘×”×¦×œ×—×”, ××—×›×” ×œ×—×™×‘×•×¨ Firebase...");

</script>

</body>
</html>