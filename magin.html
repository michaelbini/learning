<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ğŸ¡ ×¨×•×œ×˜×” ××™×§×•××™× ××¢×•×¦×‘×ª</title>
<style>
* {
  box-sizing: border-box;
}

body {
  font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
  background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  margin: 0;
  padding: 20px;
  min-height: 100vh;
  display: flex;
  flex-direction: column;
  align-items: center;
  color: #333;
}

.container {
  background: rgba(255, 255, 255, 0.95);
  backdrop-filter: blur(10px);
  border-radius: 20px;
  padding: 30px;
  box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
  max-width: 600px;
  width: 100%;
  text-align: center;
}

h1 {
  color: #4a5568;
  margin-bottom: 30px;
  font-size: 2.5rem;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
}

.input-section {
  display: flex;
  flex-direction: column;
  gap: 15px;
  margin-bottom: 25px;
}

.input-row {
  display: flex;
  gap: 10px;
  align-items: center;
  flex-wrap: wrap;
}

input {
  flex: 1;
  min-width: 150px;
  font-size: 16px;
  padding: 12px 15px;
  border: 2px solid #e2e8f0;
  border-radius: 12px;
  transition: all 0.3s ease;
  background: #f8fafc;
}

input:focus {
  outline: none;
  border-color: #4299e1;
  background: white;
  box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
}

button {
  font-size: 16px;
  padding: 12px 20px;
  border: none;
  border-radius: 12px;
  cursor: pointer;
  transition: all 0.3s ease;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.btn-add {
  background: linear-gradient(45deg, #48bb78, #38a169);
  color: white;
  box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
}

.btn-add:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(72, 187, 120, 0.6);
}

.btn-reset {
  background: linear-gradient(45deg, #f56565, #e53e3e);
  color: white;
  box-shadow: 0 4px 15px rgba(245, 101, 101, 0.4);
}

.btn-reset:hover:not(:disabled) {
  transform: translateY(-2px);
  box-shadow: 0 6px 20px rgba(245, 101, 101, 0.6);
}

.btn-spin {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  font-size: 20px;
  padding: 15px 30px;
  margin: 20px 0;
  box-shadow: 0 6px 20px rgba(102, 126, 234, 0.4);
}

.btn-spin:hover:not(:disabled) {
  transform: translateY(-3px);
  box-shadow: 0 8px 25px rgba(102, 126, 234, 0.6);
}

button:disabled {
  background: #cbd5e0;
  color: #a0aec0;
  cursor: not-allowed;
  transform: none !important;
  box-shadow: none !important;
}

.status {
  padding: 12px 20px;
  margin: 15px 0;
  border-radius: 12px;
  font-weight: 600;
  transition: all 0.3s ease;
}

.status.success {
  background: linear-gradient(45deg, #c6f6d5, #9ae6b4);
  color: #22543d;
  border: 2px solid #68d391;
}

.status.error {
  background: linear-gradient(45deg, #fed7d7, #feb2b2);
  color: #742a2a;
  border: 2px solid #f56565;
}

.status.connecting {
  background: linear-gradient(45deg, #bee3f8, #90cdf4);
  color: #2a4365;
  border: 2px solid #4299e1;
}

.participants {
  background: #f7fafc;
  border-radius: 12px;
  padding: 15px;
  margin: 20px 0;
  border: 2px solid #e2e8f0;
}

.participants h3 {
  margin: 0 0 10px 0;
  color: #4a5568;
}

.participant-list {
  display: flex;
  flex-wrap: wrap;
  gap: 8px;
  justify-content: center;
}

.participant-tag {
  background: linear-gradient(45deg, #667eea, #764ba2);
  color: white;
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 14px;
  font-weight: 500;
  box-shadow: 0 2px 8px rgba(102, 126, 234, 0.3);
}

.wheel-container {
  position: relative;
  margin: 30px auto;
}

#wheel {
  width: 350px;
  height: 350px;
  border-radius: 50%;
  border: 8px solid #4a5568;
  position: relative;
  transition: transform 4s cubic-bezier(0.2, 0, 0.2, 1);
  overflow: hidden;
  box-shadow: 
    0 0 0 4px rgba(255, 255, 255, 0.3),
    0 20px 40px rgba(0, 0, 0, 0.2),
    inset 0 0 20px rgba(0, 0, 0, 0.1);
  background: conic-gradient(from 0deg, #ff6b6b, #4ecdc4, #45b7d1, #96ceb4, #feca57, #ff9ff3, #54a0ff);
}

.slice {
  position: absolute;
  width: 50%;
  height: 50%;
  top: 50%;
  left: 50%;
  transform-origin: 0% 0%;
  display: flex;
  justify-content: center;
  align-items: center;
  font-size: 13px;
  font-weight: bold;
  color: white;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
  border-right: 2px solid rgba(255, 255, 255, 0.3);
  word-break: break-word;
  text-align: center;
  padding: 5px;
}

#pointer {
  position: absolute;
  top: -25px;
  left: 50%;
  transform: translateX(-50%);
  width: 0;
  height: 0;
  border-left: 20px solid transparent;
  border-right: 20px solid transparent;
  border-bottom: 40px solid #e53e3e;
  filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.3));
  z-index: 10;
}

#result {
  font-size: 28px;
  margin-top: 20px;
  font-weight: bold;
  padding: 20px;
  border-radius: 12px;
  background: linear-gradient(45deg, #48bb78, #38a169);
  color: white;
  text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
  box-shadow: 0 8px 25px rgba(72, 187, 120, 0.4);
  transform: scale(0);
  transition: transform 0.5s cubic-bezier(0.68, -0.55, 0.265, 1.55);
}

#result.show {
  transform: scale(1);
}

.empty-wheel {
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 18px;
  color: #718096;
  height: 100%;
  background: linear-gradient(135deg, #f7fafc, #edf2f7);
}

@media (max-width: 600px) {
  .container {
    padding: 20px;
  }
  
  h1 {
    font-size: 2rem;
  }
  
  #wheel {
    width: 280px;
    height: 280px;
  }
  
  .input-row {
    flex-direction: column;
  }
  
  input {
    min-width: unset;
  }
}

/* ×× ×™××¦×™×•×ª */
@keyframes pulse {
  0%, 100% { transform: scale(1); }
  50% { transform: scale(1.05); }
}

.btn-spin:not(:disabled) {
  animation: pulse 2s infinite;
}

@keyframes fadeInUp {
  from {
    opacity: 0;
    transform: translateY(30px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

.container {
  animation: fadeInUp 0.8s ease-out;
}
</style>
</head>

<body>
<div class="container">
  <h1>ğŸ¡ ×¨×•×œ×˜×” ××™×§×•××™×</h1>
  
  <div class="input-section">
    <div class="input-row">
      <input id="nameInput" placeholder="×”×›× ×¡ ×©× × ×¦×™×’" type="text">
      <input id="locationInput" placeholder="×”×›× ×¡ ××™×§×•×" type="text">
    </div>
    <div class="input-row">
      <button onclick="addParticipant()" class="btn-add" id="addBtn">ğŸŒ ×”×•×¡×£ ××™×§×•×</button>
      <button onclick="reset()" class="btn-reset" id="resetBtn">ğŸ—‘ï¸ × ×§×” ×”×›×œ</button>
    </div>
  </div>

  <div id="status" class="status connecting">××ª×—×‘×¨ ×œ-Firebase...</div>

  <div class="participants">
    <h3>ğŸŒ ××™×§×•××™× ×•× ×¦×™×’×™×</h3>
    <div id="participantsList" class="participant-list">
      ××™×Ÿ ××™×§×•××™× ×¢×“×™×™×Ÿ
    </div>
  </div>

  <div class="wheel-container">
    <div id="pointer"></div>
    <div id="wheel">
      <div class="empty-wheel">×”×•×¡×£ ××©×ª×ª×¤×™× ×›×“×™ ×œ×”×ª×—×™×œ! ğŸ¯</div>
    </div>
  </div>

  <button onclick="spin()" class="btn-spin" id="spinBtn">ğŸ² ×¡×•×‘×‘ ××ª ×”×¨×•×œ×˜×”!</button>
  
  <div id="result"></div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

const firebaseConfig = {
  apiKey: "AIzaSyBWc81acgd-9tVi4wLlAw_PXdEgR0n81qU",
  authDomain: "trip-9506c.firebaseapp.com",
  projectId: "trip-9506c",
  storageBucket: "trip-9506c.firebasestorage.app",
  messagingSenderId: "813393240812",
  appId: "1:813393240812:web:929bed95de2c48d5e43bc9",
  databaseURL: "https://trip-9506c-default-rtdb.firebaseio.com/"
};

let app, db, participantsRef;
let participants = [];
let rotation = 0;
let isConnected = false;
let isSpinning = false;

function showStatus(message, type) {
  const statusDiv = document.getElementById("status");
  statusDiv.textContent = message;
  statusDiv.className = `status ${type}`;
  
  if (type === "success") {
    setTimeout(() => {
      statusDiv.style.display = "none";
    }, 3000);
  } else {
    statusDiv.style.display = "block";
  }
}

function updateButtons() {
  const addBtn = document.getElementById("addBtn");
  const resetBtn = document.getElementById("resetBtn");
  const spinBtn = document.getElementById("spinBtn");
  
  addBtn.disabled = !isConnected || isSpinning;
  resetBtn.disabled = !isConnected || isSpinning;
  spinBtn.disabled = !isConnected || participants.length === 0 || isSpinning;
}

function renderParticipants() {
  const listDiv = document.getElementById("participantsList");
  
  if (participants.length === 0) {
    listDiv.innerHTML = "××™×Ÿ ××™×§×•××™× ×¢×“×™×™×Ÿ";
    return;
  }
  
  listDiv.innerHTML = "";
  participants.forEach(participant => {
    const tag = document.createElement("div");
    tag.className = "participant-tag";
    tag.innerHTML = `<strong>${participant.location}</strong><br><small>× ×¦×™×’: ${participant.name}</small>`;
    listDiv.appendChild(tag);
  });
}

function renderWheel() {
  const wheel = document.getElementById("wheel");
  wheel.innerHTML = "";
  
  if (participants.length === 0) {
    wheel.innerHTML = '<div class="empty-wheel">×”×•×¡×£ ××™×§×•××™× ×›×“×™ ×œ×”×ª×—×™×œ! ğŸŒ</div>';
    return;
  }

  const angle = 360 / participants.length;
  const colors = [
    '#ff6b6b', '#4ecdc4', '#45b7d1', '#96ceb4', '#feca57', 
    '#ff9ff3', '#54a0ff', '#5f27cd', '#00d2d3', '#ff9f43',
    '#ee5a24', '#0984e3', '#6c5ce7', '#a29bfe', '#fd79a8'
  ];

  participants.forEach((participant, i) => {
    const slice = document.createElement("div");
    slice.className = "slice";
    slice.style.transform = `rotate(${i * angle}deg)`;
    slice.style.background = `linear-gradient(45deg, ${colors[i % colors.length]}, ${colors[(i + 1) % colors.length]})`;
    slice.innerText = participant.location; // ×”×¦×’×ª ××™×§×•× ×‘××§×•× ×©×
    wheel.appendChild(slice);
  });
}

// ××ª×—×•×œ Firebase
try {
  app = initializeApp(firebaseConfig);
  db = getDatabase(app);
  participantsRef = ref(db, "participants");
  
  onValue(participantsRef, (snapshot) => {
    try {
      const data = snapshot.val();
      participants = data ? Object.values(data) : [];
      
      if (!isConnected) {
        isConnected = true;
        showStatus("××—×•×‘×¨ ×‘×”×¦×œ×—×” ×œ-Firebase! ğŸ‰", "success");
      }
      
      renderParticipants();
      renderWheel();
      updateButtons();
      
    } catch (error) {
      showStatus("×©×’×™××” ×‘×¢×™×‘×•×“ × ×ª×•× ×™×", "error");
    }
  }, (error) => {
    showStatus(`×©×’×™××” ×‘×—×™×‘×•×¨: ${error.message}`, "error");
    isConnected = false;
    updateButtons();
  });
  
} catch (error) {
  showStatus("×©×’×™××” ×‘××ª×—×•×œ Firebase", "error");
}

// ×”×•×¡×¤×ª ××©×ª×ª×£
window.addParticipant = function() {
  const nameInput = document.getElementById("nameInput");
  const locationInput = document.getElementById("locationInput");
  
  const name = nameInput.value.trim();
  const location = locationInput.value.trim();
  
  if (!name) {
    showStatus("×× × ×”×›× ×¡ ×©×", "error");
    nameInput.focus();
    return;
  }
  
  if (!location) {
    showStatus("×× × ×”×›× ×¡ ××™×§×•×", "error");
    locationInput.focus();
    return;
  }
  
  // ×‘×“×™×§×ª ×›×¤×™×œ×•×™×•×ª ×œ×¤×™ ××™×§×•×
  if (participants.some(p => p.location === location)) {
    showStatus(`×”××™×§×•× "${location}" ×›×‘×¨ ×§×™×™×`, "error");
    locationInput.focus();
    return;
  }
  
  if (!isConnected) {
    showStatus("××™×Ÿ ×—×™×‘×•×¨ ×œ-Firebase", "error");
    return;
  }
  
  const participant = { name, location };
  
  push(participantsRef, participant)
    .then(() => {
      showStatus(`×”××™×§×•× "${location}" × ×•×¡×£ ×‘×”×¦×œ×—×”! âœ…`, "success");
      nameInput.value = "";
      locationInput.value = "";
      nameInput.focus();
    })
    .catch(error => {
      showStatus(`×©×’×™××” ×‘×”×•×¡×¤×”: ${error.message}`, "error");
    });
};

// ××™×¤×•×¡
window.reset = function() {
  if (!isConnected) {
    showStatus("××™×Ÿ ×—×™×‘×•×¨ ×œ-Firebase", "error");
    return;
  }
  
  if (participants.length === 0) {
    showStatus("×”×¨×©×™××” ×›×‘×¨ ×¨×™×§×”", "error");
    return;
  }
  
  if (!confirm(`×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×›×œ ${participants.length} ×”××™×§×•××™×?`)) {
    return;
  }
  
  remove(participantsRef)
    .then(() => {
      showStatus("×›×œ ×”××™×§×•××™× × ××—×§×•! ğŸ—‘ï¸", "success");
      document.getElementById("result").textContent = "";
      document.getElementById("result").classList.remove("show");
    })
    .catch(error => {
      showStatus(`×©×’×™××” ×‘××—×™×§×”: ${error.message}`, "error");
    });
};

// ×¡×™×‘×•×‘ ×”×¨×•×œ×˜×”
window.spin = function() {
  if (!isConnected || participants.length === 0 || isSpinning) return;
  
  isSpinning = true;
  updateButtons();
  
  const spinBtn = document.getElementById("spinBtn");
  const resultDiv = document.getElementById("result");
  
  spinBtn.innerText = "ğŸ² ××¡×•×‘×‘...";
  resultDiv.classList.remove("show");
  
  // ×¡×™×‘×•×‘ ××§×¨××™
  const spins = Math.floor(Math.random() * 5) + 3; // 3-7 ×¡×™×‘×•×‘×™×
  const extraAngle = Math.floor(Math.random() * 360);
  const totalRotation = (spins * 360) + extraAngle;
  
  rotation += totalRotation;
  document.getElementById("wheel").style.transform = `rotate(${rotation}deg)`;

  // ×—×™×©×•×‘ ×–×•×›×”
  const angle = 360 / participants.length;
  const normalizedRotation = (360 - (rotation % 360)) % 360;
  const winnerIndex = Math.floor(normalizedRotation / angle);
  const winner = participants[winnerIndex];

  setTimeout(() => {
    resultDiv.innerHTML = `ğŸ‰ ×”××™×§×•× ×”×–×•×›×”:<br><strong>${winner.location}</strong><br><small>× ×¦×™×’: ${winner.name}</small>`;
    resultDiv.classList.add("show");
    
    isSpinning = false;
    spinBtn.innerText = "ğŸ² ×¡×•×‘×‘ ××ª ×”×¨×•×œ×˜×”!";
    updateButtons();
  }, 4000);
};

// ××™×¨×•×¢×™ ××§×œ×“×ª
document.getElementById("nameInput").addEventListener("keydown", function(event) {
  if (event.key === "Enter") {
    document.getElementById("locationInput").focus();
  }
});

document.getElementById("locationInput").addEventListener("keydown", function(event) {
  if (event.key === "Enter") {
    addParticipant();
  }
});

// ××ª×—×•×œ
updateButtons();

</script>
</body>
</html>