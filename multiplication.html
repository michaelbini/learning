<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××¨×•×¥ ×”×›×¤×œ - ×›×™×ª×” ×”'</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸï¸ ××¨×•×¥ ×”×›×¤×œ ğŸï¸</h1>

        <div class="main-card">
            <!-- ×‘×—×™×¨×ª ×¨××” -->
            <div class="level-selector">
                <button class="level-btn active" onclick="selectLevel(1, this)">
                    ×¨××” 1
                    <span class="level-stars">â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(2, this)">
                    ×¨××” 2
                    <span class="level-stars">â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(3, this)">
                    ×¨××” 3
                    <span class="level-stars">â­â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(4, this)">
                    ×¨××” 4
                    <span class="level-stars">â­â­â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(5, this)">
                    ×¨××” 5
                    <span class="level-stars">â­â­â­â­â­</span>
                </button>
            </div>

            <!-- ×œ×•×— × ×™×§×•×“ -->
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">× ×§×•×“×•×ª</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨××”</div>
                    <div class="score-value" id="currentLevel">1</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×“×™×•×§</div>
                    <div class="score-value"><span id="accuracy">100</span>%</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨×¦×£</div>
                    <div class="score-value" id="streak">0</div>
                </div>
            </div>

            <!-- ×©××œ×” -->
            <div class="question-display" id="question">
                12 Ã— 7 = ?
            </div>

            <!-- ××¡×œ×•×œ ××¨×•×¥ -->
            <div class="race-track">
                <div class="car player-car" id="playerCar">ğŸï¸</div>
                <div class="car computer-car" id="computerCar">ğŸš—</div>
                <div class="finish-line">ğŸ</div>
            </div>

            <!-- ×§×œ×˜ ×ª×©×•×‘×” -->
            <div style="text-align: center; margin: 30px 0;">
                <input type="number" class="answer-input" id="answer" placeholder="×”×ª×©×•×‘×” ×©×œ×š" autofocus>
            </div>

            <!-- ×›×¤×ª×•×¨×™× -->
            <div style="text-align: center;">
                <button class="btn btn-primary" onclick="checkAnswer()">×‘×“×•×§</button>
                <button class="btn btn-warning" onclick="skipQuestion()">×“×œ×’ (-3 × ×§')</button>
                <button class="btn btn-success" onclick="newRace()">××¨×•×¥ ×—×“×©</button>
            </div>

            <!-- ××©×•×‘ -->
            <div class="feedback" id="feedback"></div>

            <!-- ×”×ª×§×“××•×ª -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0/10</div>
            </div>
        </div>

        <!-- ×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™ -->
        <div style="text-align: center; margin-top: 20px;">
            <a href="index.html" class="btn btn-secondary">â†©ï¸ ×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™</a>
        </div>
    </div>

    <script>
        // ××©×ª× ×™ ××©×—×§
        let currentLevel = 1;
        let score = 0;
        let streak = 0;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let questionsInRace = 0;

        // ××©×ª× ×™ ××¨×•×¥
        let currentAnswer = 0;
        let playerPosition = 0;
        let computerPosition = 0;
        let raceActive = false;

        // ××ª×—×•×œ
        window.addEventListener('load', () => {
            initGame();
            loadProgress();
        });

        function initGame() {
            newRace();
        }

        function selectLevel(level, button) {
            currentLevel = level;

            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');

            document.getElementById('currentLevel').textContent = level;
            newRace();
        }

        function newRace() {
            playerPosition = 0;
            computerPosition = 0;
            questionsInRace = 0;
            raceActive = true;

            document.getElementById('playerCar').style.left = '0%';
            document.getElementById('computerCar').style.left = '0%';

            newQuestion();
        }

        function newQuestion() {
            if (!raceActive) return;

            let a, b;

            // ×¨××•×ª ×§×•×©×™
            if (currentLevel === 1) {
                a = Math.floor(Math.random() * 10) + 1;
                b = Math.floor(Math.random() * 10) + 1;
            } else if (currentLevel === 2) {
                a = Math.floor(Math.random() * 12) + 1;
                b = Math.floor(Math.random() * 12) + 1;
            } else if (currentLevel === 3) {
                a = Math.floor(Math.random() * 15) + 1;
                b = Math.floor(Math.random() * 12) + 1;
            } else if (currentLevel === 4) {
                a = Math.floor(Math.random() * 20) + 10;
                b = Math.floor(Math.random() * 10) + 1;
            } else {
                a = Math.floor(Math.random() * 25) + 10;
                b = Math.floor(Math.random() * 12) + 1;
            }

            currentAnswer = a * b;
            document.getElementById('question').textContent = `${a} Ã— ${b} = ?`;
            document.getElementById('answer').value = '';
            document.getElementById('answer').focus();
        }

        function checkAnswer() {
            if (!raceActive) return;

            totalQuestions++;
            questionsInRace++;

            const userAnswer = parseInt(document.getElementById('answer').value);

            if (userAnswer === currentAnswer) {
                correctAnswers++;
                streak++;

                // ×”××›×•× ×™×ª ×©×œ×š ××ª×§×“××ª
                playerPosition += 10;
                document.getElementById('playerCar').style.left = playerPosition + '%';

                let points = 10 * currentLevel + (streak >= 3 ? streak * 2 : 0);
                score += points;

                showFeedback(`âœ“ × ×›×•×Ÿ! +${points} × ×§×•×“×•×ª`, 'correct');

                // ×‘×“×•×§ ×× × ×™×¦×—×ª
                if (playerPosition >= 90) {
                    raceWon();
                } else {
                    setTimeout(() => newQuestion(), 1000);
                }
            } else {
                streak = 0;

                // ×”××ª×—×¨×” ××ª×§×“×
                computerPosition += 15;
                document.getElementById('computerCar').style.left = computerPosition + '%';

                showFeedback(`âœ— ×œ× × ×›×•×Ÿ. ×”×ª×©×•×‘×”: ${currentAnswer}`, 'incorrect');

                // ×‘×“×•×§ ×× ×”××ª×—×¨×” × ×™×¦×—
                if (computerPosition >= 90) {
                    raceLost();
                } else {
                    setTimeout(() => newQuestion(), 1500);
                }
            }

            updateStats();
            updateProgress();
        }

        function skipQuestion() {
            score = Math.max(0, score - 3);
            updateStats();

            computerPosition += 5;
            document.getElementById('computerCar').style.left = computerPosition + '%';

            if (computerPosition >= 90) {
                raceLost();
            } else {
                newQuestion();
            }
        }

        function raceWon() {
            raceActive = false;
            showFeedback('ğŸ† × ×™×¦×—×ª ×‘××¨×•×¥! ×›×œ ×”×›×‘×•×“!', 'correct');

            if (questionsInRace >= 5 && currentLevel < 5) {
                currentLevel++;
                document.getElementById('currentLevel').textContent = currentLevel;
                showFeedback(`ğŸŠ ×¢×œ×™×ª ×œ×¨××” ${currentLevel}!`, 'correct');
            }

            setTimeout(() => {
                if (confirm('×¨×•×¦×” ×œ×”×ª×—×™×œ ××¨×•×¥ ×—×“×©?')) {
                    newRace();
                }
            }, 2000);
        }

        function raceLost() {
            raceActive = false;
            showFeedback('ğŸ˜” ×”××ª×—×¨×” × ×™×¦×—. × ×¡×” ×©×•×‘!', 'incorrect');

            setTimeout(() => {
                if (confirm('×¨×•×¦×” ×œ×”×ª×—×™×œ ××¨×•×¥ ×—×“×©?')) {
                    newRace();
                }
            }, 2000);
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback show ${type}`;

            setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('streak').textContent = streak;

            const accuracy = totalQuestions > 0 ?
                Math.round((correctAnswers / totalQuestions) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy;
        }

        function updateProgress() {
            const progress = Math.max(playerPosition, computerPosition);
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${questionsInRace}/10`;
        }

        function saveProgress() {
            localStorage.setItem('multiplication_score', score);
            localStorage.setItem('multiplication_level', currentLevel);
        }

        function loadProgress() {
            const savedScore = localStorage.getItem('multiplication_score');
            if (savedScore) {
                score = parseInt(savedScore);
                updateStats();
            }
        }

        // ×ª××™×›×” ×‘-Enter
        document.getElementById('answer').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                checkAnswer();
            }
        });

        // ×©××™×¨×” ××•×˜×•××˜×™×ª
        window.addEventListener('beforeunload', saveProgress);
    </script>
</body>
</html>
