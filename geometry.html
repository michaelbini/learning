<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×‘×•× ×” ×”×’×™××•××˜×¨×™×” - ×›×™×ª×” ×”'</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1>ğŸ“ ×‘×•× ×” ×”×’×™××•××˜×¨×™×” ğŸ“</h1>

        <div class="main-card">
            <!-- ×‘×—×™×¨×ª ×¨××” -->
            <div class="level-selector">
                <button class="level-btn active" onclick="selectLevel(1, this)">
                    ×¨××” 1
                    <span class="level-stars">â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(2, this)">
                    ×¨××” 2
                    <span class="level-stars">â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(3, this)">
                    ×¨××” 3
                    <span class="level-stars">â­â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(4, this)">
                    ×¨××” 4
                    <span class="level-stars">â­â­â­â­</span>
                </button>
                <button class="level-btn" onclick="selectLevel(5, this)">
                    ×¨××” 5
                    <span class="level-stars">â­â­â­â­â­</span>
                </button>
            </div>

            <!-- ×œ×•×— × ×™×§×•×“ -->
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">× ×§×•×“×•×ª</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨××”</div>
                    <div class="score-value" id="currentLevel">1</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×“×™×•×§</div>
                    <div class="score-value"><span id="accuracy">100</span>%</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨×¦×£</div>
                    <div class="score-value" id="streak">0</div>
                </div>
            </div>

            <!-- ×©××œ×” -->
            <div class="question-display" id="question">
                ×¦×•×¨ ××œ×‘×Ÿ ×¢× ×©×˜×— ×©×œ <span class="highlight">24</span> ××©×‘×¦×•×ª
            </div>

            <!-- ×¨×©×ª -->
            <div class="geometry-grid" id="grid"></div>

            <!-- ××™×“×¢ × ×•×›×—×™ -->
            <div style="text-align: center; margin: 20px 0;">
                <div style="font-size: 1.3em;">
                    ×©×˜×— × ×•×›×—×™: <span id="currentArea" style="font-weight: bold; color: #667eea;">0</span> ××©×‘×¦×•×ª
                </div>
                <div style="font-size: 1.1em; margin-top: 10px; color: #666;">
                    ×¨×•×—×‘: <span id="currentWidth">0</span> Ã— ×’×•×‘×”: <span id="currentHeight">0</span>
                </div>
            </div>

            <!-- ×›×¤×ª×•×¨×™× -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="checkAnswer()">×‘×“×•×§ ×ª×©×•×‘×”</button>
                <button class="btn btn-warning" onclick="clearGrid()">× ×§×”</button>
                <button class="btn btn-success" onclick="newQuestion()">×©××œ×” ×—×“×©×”</button>
                <button class="btn btn-info" onclick="showHint()">ğŸ’¡ ×¨××– (-5 × ×§')</button>
            </div>

            <!-- ××©×•×‘ -->
            <div class="feedback" id="feedback"></div>

            <!-- ×”×ª×§×“××•×ª -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0/10</div>
            </div>
        </div>

        <!-- ×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™ -->
        <div style="text-align: center; margin-top: 20px;">
            <a href="index.html" class="btn btn-secondary">â†©ï¸ ×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™</a>
        </div>
    </div>

    <script>
        // ××©×ª× ×™ ××©×—×§
        let currentLevel = 1;
        let score = 0;
        let streak = 0;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let questionsInLevel = 0;

        // ××©×ª× ×™ ×’×™××•××˜×¨×™×”
        let targetArea = 24;
        let selectedCells = new Set();
        let gridSize = 10;

        // ××ª×—×•×œ
        window.addEventListener('load', () => {
            initGame();
            loadProgress();
        });

        function initGame() {
            createGrid();
            newQuestion();
        }

        function selectLevel(level, button) {
            currentLevel = level;
            questionsInLevel = 0;

            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');

            document.getElementById('currentLevel').textContent = level;
            newQuestion();
        }

        function createGrid() {
            const grid = document.getElementById('grid');
            grid.innerHTML = '';
            selectedCells.clear();

            // ×™×¦×™×¨×ª ×¨×©×ª 10x10
            for (let i = 0; i < gridSize * gridSize; i++) {
                const cell = document.createElement('div');
                cell.className = 'grid-cell';
                cell.onclick = () => toggleCell(i);
                cell.id = 'cell' + i;
                grid.appendChild(cell);
            }

            updateAreaDisplay();
        }

        function toggleCell(index) {
            const cell = document.getElementById('cell' + index);

            if (selectedCells.has(index)) {
                selectedCells.delete(index);
                cell.classList.remove('selected');
            } else {
                selectedCells.add(index);
                cell.classList.add('selected');
            }

            updateAreaDisplay();
        }

        function clearGrid() {
            selectedCells.clear();
            document.querySelectorAll('.grid-cell').forEach(cell => {
                cell.classList.remove('selected');
            });
            updateAreaDisplay();
        }

        function updateAreaDisplay() {
            document.getElementById('currentArea').textContent = selectedCells.size;

            const dimensions = getRectangleDimensions();
            if (dimensions) {
                document.getElementById('currentWidth').textContent = dimensions.width;
                document.getElementById('currentHeight').textContent = dimensions.height;
            } else {
                document.getElementById('currentWidth').textContent = '0';
                document.getElementById('currentHeight').textContent = '0';
            }
        }

        function newQuestion() {
            clearGrid();

            // ×¨××•×ª ×§×•×©×™
            if (currentLevel === 1) {
                // ××¡×¤×¨×™× ×¤×©×•×˜×™× ×©×§×œ ×œ×¢×©×•×ª ××”× ××œ×‘×Ÿ
                targetArea = [12, 16, 20, 24, 30][Math.floor(Math.random() * 5)];
            } else if (currentLevel === 2) {
                targetArea = [15, 18, 21, 24, 28, 32][Math.floor(Math.random() * 6)];
            } else if (currentLevel === 3) {
                targetArea = Math.floor(Math.random() * 25) + 15;
            } else if (currentLevel === 4) {
                targetArea = Math.floor(Math.random() * 35) + 20;
            } else {
                targetArea = Math.floor(Math.random() * 45) + 25;
            }

            document.getElementById('question').innerHTML =
                `×¦×•×¨ ××œ×‘×Ÿ ×¢× ×©×˜×— ×©×œ <span class="highlight">${targetArea}</span> ××©×‘×¦×•×ª`;
        }

        function checkAnswer() {
            totalQuestions++;
            questionsInLevel++;

            if (selectedCells.size === targetArea) {
                // ×‘×“×•×§ ×× ×–×” ×‘×××ª ××œ×‘×Ÿ
                if (isRectangle()) {
                    correctAnswers++;
                    streak++;
                    let points = 20 * currentLevel + (streak >= 3 ? streak * 3 : 0);
                    score += points;

                    const dimensions = getRectangleDimensions();
                    showFeedback(`ğŸ‰ ××¢×•×œ×”! ×™×¦×¨×ª ××œ×‘×Ÿ ${dimensions.width}Ã—${dimensions.height}! +${points} × ×§×•×“×•×ª`, 'correct');

                    setTimeout(() => {
                        if (questionsInLevel >= 10) {
                            levelComplete();
                        } else {
                            newQuestion();
                        }
                    }, 2500);
                } else {
                    streak = 0;
                    showFeedback('âŒ ×”×©×˜×— × ×›×•×Ÿ ××‘×œ ×–×” ×œ× ××œ×‘×Ÿ. × ×¡×” ×œ×™×¦×•×¨ ×¦×•×¨×” ×¨×¦×™×¤×”!', 'incorrect');
                }
            } else {
                streak = 0;
                showFeedback(`âŒ ×”×©×˜×— ×©×œ×š ×”×•× ${selectedCells.size}, ×¦×¨×™×š ${targetArea}`, 'incorrect');
            }

            updateStats();
            updateProgress();
        }

        function isRectangle() {
            if (selectedCells.size === 0) return false;

            const cells = Array.from(selectedCells);
            const rows = cells.map(c => Math.floor(c / gridSize));
            const cols = cells.map(c => c % gridSize);

            const minRow = Math.min(...rows);
            const maxRow = Math.max(...rows);
            const minCol = Math.min(...cols);
            const maxCol = Math.max(...cols);

            const expectedArea = (maxRow - minRow + 1) * (maxCol - minCol + 1);

            // ×‘×“×•×§ ×©×›×œ ×”×ª××™× ×”×“×¨×•×©×™× ××¡×•×× ×™×
            if (expectedArea !== selectedCells.size) return false;

            // ×‘×“×•×§ ×©×›×œ ×”×ª××™× ×¨×¦×™×¤×™×
            for (let r = minRow; r <= maxRow; r++) {
                for (let c = minCol; c <= maxCol; c++) {
                    const index = r * gridSize + c;
                    if (!selectedCells.has(index)) return false;
                }
            }

            return true;
        }

        function getRectangleDimensions() {
            if (selectedCells.size === 0 || !isRectangle()) return null;

            const cells = Array.from(selectedCells);
            const rows = cells.map(c => Math.floor(c / gridSize));
            const cols = cells.map(c => c % gridSize);

            const width = Math.max(...cols) - Math.min(...cols) + 1;
            const height = Math.max(...rows) - Math.min(...rows) + 1;

            return { width, height };
        }

        function showHint() {
            score = Math.max(0, score - 5);
            updateStats();

            // ××¦× ×’×•×¨××™× ×©×œ ×”××¡×¤×¨
            const factors = [];
            for (let i = 1; i <= targetArea; i++) {
                if (targetArea % i === 0 && i <= gridSize && targetArea / i <= gridSize) {
                    factors.push(`${i}Ã—${targetArea / i}`);
                }
            }

            if (factors.length > 0) {
                showFeedback(`ğŸ’¡ ××¤×©×¨×•×™×•×ª: ${factors.join(', ')}`, 'correct');
            } else {
                showFeedback(`ğŸ’¡ ×”××¡×¤×¨ ${targetArea} ×œ× × ×™×ª×Ÿ ×œ××œ×‘×Ÿ ×‘×¨×©×ª ${gridSize}Ã—${gridSize}`, 'incorrect');
            }
        }

        function levelComplete() {
            showFeedback(`ğŸŠ ×¡×™×™××ª ×¨××” ${currentLevel}!`, 'correct');

            if (currentLevel < 5) {
                currentLevel++;
                questionsInLevel = 0;
                selectLevel(currentLevel, document.querySelectorAll('.level-btn')[currentLevel - 1]);
            } else {
                gameComplete();
            }
        }

        function gameComplete() {
            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);

            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ† ×›×œ ×”×›×‘×•×“! ğŸ†</h2>
                    <p>×¡×™×™××ª ××ª ×›×œ ×”×¨××•×ª!</p>
                    <div class="grade-circle excellent">${score}</div>
                    <p>×“×™×•×§: ${accuracy}%</p>
                    <button class="btn btn-primary" onclick="location.reload()">×©×—×§ ×©×•×‘</button>
                    <button class="btn btn-secondary" onclick="location.href='index.html'">×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™</button>
                </div>
            `;
            document.body.appendChild(modal);

            saveProgress();
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback show ${type}`;

            setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('streak').textContent = streak;

            const accuracy = totalQuestions > 0 ?
                Math.round((correctAnswers / totalQuestions) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy;
        }

        function updateProgress() {
            const progress = (questionsInLevel / 10) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${questionsInLevel}/10`;
        }

        function saveProgress() {
            localStorage.setItem('geometry_score', score);
            localStorage.setItem('geometry_level', currentLevel);
        }

        function loadProgress() {
            const savedScore = localStorage.getItem('geometry_score');
            if (savedScore) {
                score = parseInt(savedScore);
                updateStats();
            }
        }
    </script>
</body>
</html>
