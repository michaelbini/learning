<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload Vocabulary to Firebase</title>
    <style>
        body {
            font-family: 'Consolas', 'Monaco', monospace;
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 40px;
            max-width: 800px;
            margin: 0 auto;
        }
        h1 { color: #569cd6; }
        .status {
            background: #252526;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
            min-height: 200px;
        }
        .success { color: #4ec9b0; }
        .error { color: #f14c4c; }
        .info { color: #569cd6; }
        .warn { color: #cca700; }
        button {
            background: #0e639c;
            color: white;
            border: none;
            padding: 12px 24px;
            font-size: 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background: #1177bb; }
        button:disabled { background: #555; cursor: not-allowed; }
        button.danger { background: #c53030; }
        button.danger:hover { background: #e53e3e; }
        .controls { margin: 20px 0; }
        pre {
            background: #333;
            padding: 15px;
            border-radius: 4px;
            overflow-x: auto;
        }
        .summary {
            background: #2d4a3e;
            border-left: 4px solid #4ec9b0;
            padding: 15px;
            margin: 20px 0;
            border-radius: 0 8px 8px 0;
        }
        .summary.error {
            background: #4a2d2d;
            border-left-color: #f14c4c;
        }
    </style>
</head>
<body>
    <h1>üî• Upload Vocabulary to Firebase</h1>
    <p>This tool uploads local JSON vocabulary files to Firebase Realtime Database.</p>

    <div class="controls">
        <button onclick="uploadAll()" id="uploadBtn">üì§ Upload All Vocabulary</button>
        <button onclick="uploadEnglish()" class="secondary">üá¨üáß English Only</button>
        <button onclick="uploadHebrew()" class="secondary">üáÆüá± Hebrew Only</button>
        <button onclick="verifyData()">‚úÖ Verify Firebase Data</button>
        <button onclick="clearLog()">üóëÔ∏è Clear Log</button>
    </div>

    <div class="status" id="status">
        Click "Upload All Vocabulary" to start...
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, set, get } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase configuration (same as magin.html)
        const firebaseConfig = {
            apiKey: "AIzaSyBWc81acgd-9tVi4wLlAw_PXdEgR0n81qU",
            authDomain: "trip-9506c.firebaseapp.com",
            projectId: "trip-9506c",
            storageBucket: "trip-9506c.firebasestorage.app",
            messagingSenderId: "813393240812",
            appId: "1:813393240812:web:929bed95de2c48d5e43bc9",
            databaseURL: "https://trip-9506c-default-rtdb.firebaseio.com/"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // Logging
        function log(message, type = '') {
            const status = document.getElementById('status');
            const div = document.createElement('div');
            div.className = type;
            div.textContent = `${new Date().toLocaleTimeString()} - ${message}`;
            status.appendChild(div);
            status.scrollTop = status.scrollHeight;
        }

        function clearLog() {
            document.getElementById('status').innerHTML = 'Log cleared. Ready to upload...';
        }

        // Fetch local JSON
        async function fetchLocalJson(path) {
            try {
                const response = await fetch(path);
                if (!response.ok) throw new Error(`HTTP ${response.status}`);
                return await response.json();
            } catch (error) {
                throw new Error(`Failed to load ${path}: ${error.message}`);
            }
        }

        // Upload English vocabulary
        async function uploadEnglish() {
            log('üìÅ Loading english/vocabulary.json...', 'info');

            try {
                const data = await fetchLocalJson('../english/vocabulary.json');
                log(`   Found ${data.vocabulary?.length || 0} words`, 'info');

                // Count lessons
                const lessons = [...new Set(data.vocabulary.map(w => w.lesson))];
                log(`   Lessons: ${lessons.join(', ')}`, 'info');

                log('üì§ Uploading to Firebase: vocabulary/english...', 'info');
                await set(ref(db, 'vocabulary/english'), data);

                log('‚úÖ English vocabulary uploaded successfully!', 'success');
                return true;
            } catch (error) {
                log(`‚ùå English upload failed: ${error.message}`, 'error');
                return false;
            }
        }

        // Upload Hebrew vocabulary
        async function uploadHebrew() {
            log('üìÅ Loading hebrew/vocabulary.json...', 'info');

            try {
                const data = await fetchLocalJson('../hebrew/vocabulary.json');
                const pairs = data.wordPairs || data;
                log(`   Found ${pairs.length} word pairs`, 'info');

                // Count by type
                const words = pairs.filter(p => p.type === 'words').length;
                const numbers = pairs.filter(p => p.type === 'numbers').length;
                log(`   Types: ${words} words, ${numbers} numbers`, 'info');

                // Count by difficulty
                const difficulties = {};
                pairs.forEach(p => {
                    difficulties[p.difficulty] = (difficulties[p.difficulty] || 0) + 1;
                });
                log(`   Difficulties: ${Object.entries(difficulties).map(([k,v]) => `${k}:${v}`).join(', ')}`, 'info');

                log('üì§ Uploading to Firebase: vocabulary/hebrew...', 'info');
                await set(ref(db, 'vocabulary/hebrew'), data);

                log('‚úÖ Hebrew vocabulary uploaded successfully!', 'success');
                return true;
            } catch (error) {
                log(`‚ùå Hebrew upload failed: ${error.message}`, 'error');
                return false;
            }
        }

        // Upload all
        async function uploadAll() {
            const btn = document.getElementById('uploadBtn');
            btn.disabled = true;
            btn.textContent = '‚è≥ Uploading...';

            log('üöÄ Starting full vocabulary upload...', 'info');
            log('‚îÄ'.repeat(50), '');

            const englishOk = await uploadEnglish();
            log('‚îÄ'.repeat(50), '');
            const hebrewOk = await uploadHebrew();
            log('‚îÄ'.repeat(50), '');

            if (englishOk && hebrewOk) {
                log('', '');
                log('üéâ All uploads completed successfully!', 'success');

                const summary = document.createElement('div');
                summary.className = 'summary';
                summary.innerHTML = `
                    <strong>‚úÖ Upload Complete!</strong><br>
                    ‚Ä¢ English: 87 words (2 lessons)<br>
                    ‚Ä¢ Hebrew: 792 pairs (4 difficulty levels)<br><br>
                    Next: Run tests with "Firebase" data source to verify.
                `;
                document.getElementById('status').appendChild(summary);
            } else {
                const summary = document.createElement('div');
                summary.className = 'summary error';
                summary.innerHTML = `<strong>‚ùå Some uploads failed. Check errors above.</strong>`;
                document.getElementById('status').appendChild(summary);
            }

            btn.disabled = false;
            btn.textContent = 'üì§ Upload All Vocabulary';
        }

        // Verify data in Firebase
        async function verifyData() {
            log('üîç Verifying Firebase data...', 'info');
            log('‚îÄ'.repeat(50), '');

            try {
                // Check English
                log('Checking vocabulary/english...', 'info');
                const englishSnap = await get(ref(db, 'vocabulary/english'));
                const englishData = englishSnap.val();

                if (englishData && englishData.vocabulary) {
                    log(`   ‚úÖ English: ${englishData.vocabulary.length} words found`, 'success');
                } else {
                    log('   ‚ùå English: No data or wrong structure', 'error');
                }

                // Check Hebrew
                log('Checking vocabulary/hebrew...', 'info');
                const hebrewSnap = await get(ref(db, 'vocabulary/hebrew'));
                const hebrewData = hebrewSnap.val();

                if (hebrewData && hebrewData.wordPairs) {
                    log(`   ‚úÖ Hebrew: ${hebrewData.wordPairs.length} pairs found`, 'success');
                } else {
                    log('   ‚ùå Hebrew: No data or wrong structure', 'error');
                }

                log('‚îÄ'.repeat(50), '');
                log('‚úÖ Verification complete!', 'success');

            } catch (error) {
                log(`‚ùå Verification failed: ${error.message}`, 'error');
            }
        }

        // Expose functions to window
        window.uploadAll = uploadAll;
        window.uploadEnglish = uploadEnglish;
        window.uploadHebrew = uploadHebrew;
        window.verifyData = verifyData;
        window.clearLog = clearLog;
    </script>
</body>
</html>
