<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×—×§ ×¦×™×¨ ×”××¡×¤×¨×™× - ×›×™×ª×” ×”'</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <h1>ğŸ“ ××©×—×§ ×¦×™×¨ ×”××¡×¤×¨×™× ğŸ“</h1>

        <!-- Game Setup -->
        <div id="gameSetup">
            <div class="instructions">
                <strong>ğŸ“– ×”×•×¨××•×ª ×”××©×—×§:</strong><br>
                ××§× ××¡×¤×¨×™× ×¢×œ ×¦×™×¨ ×”××¡×¤×¨×™× ×‘××™×§×•× ×”× ×›×•×Ÿ.<br>
                ×‘×—×¨ ×¨××ª ×§×•×©×™ ×•×”×ª×—×œ ×œ×©×—×§!
            </div>

            <div class="game-modes">
                <button class="mode-btn active" onclick="selectLevel(1)">
                    <span class="mode-icon">ğŸ˜Š</span>
                    <span>×¨××” 1</span>
                    
                </button>
                <button class="mode-btn" onclick="selectLevel(2)">
                    <span class="mode-icon">ğŸ¯</span>
                    <span>×¨××” 2</span>
                    
                </button>
                <button class="mode-btn" onclick="selectLevel(3)">
                    <span class="mode-icon">ğŸ’ª</span>
                    <span>×¨××” 3</span>
                    
                </button>
                <button class="mode-btn" onclick="selectLevel(4)">
                    <span class="mode-icon">ğŸ”¥</span>
                    <span>×¨××” 4</span>
                    
                </button>
                <button class="mode-btn" onclick="selectLevel(5)">
                    <span class="mode-icon">ğŸš€</span>
                    <span>×¨××” 5</span>
                    
                </button>
            </div>

            <div class="buttons-container">
                <button class="btn btn-primary" onclick="startGame()">×”×ª×—×œ ××©×—×§</button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" style="display: none;">
                <!-- ×œ×•×— × ×™×§×•×“ -->
                <div class="score-board">
                <div class="score-item">
                    <div class="score-label">× ×§×•×“×•×ª</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨××”</div>
                    <div class="score-value" id="currentLevel">1</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×“×™×•×§</div>
                    <div class="score-value"><span id="accuracy">100</span>%</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨×¦×£</div>
                    <div class="score-value" id="streak">0</div>
                </div>
            </div>

            <!-- ×©××œ×” -->
            <div class="question-display" id="question">
                ××§× ××ª ×”××¡×¤×¨ <span class="highlight">5</span> ×¢×œ ×¦×™×¨ ×”××¡×¤×¨×™×
            </div>

            <!-- ×¦×™×¨ ×”××¡×¤×¨×™× -->
            <div class="number-line-container">
                <div class="number-line" id="numberLine">
                    <div class="line"></div>
                    <div class="hint-arrow" id="hintArrow">â¬‡ï¸</div>
                    <div class="target-marker" id="targetMarker"></div>
                    <!-- ×ª×•×•×™×•×ª ×•×¡×™××•× ×™× ×™×™×•×•×¦×¨×• ×“×™× ××™×ª -->
                </div>
            </div>

            <!-- ×›×¤×ª×•×¨×™× -->
            <div style="text-align: center; margin-top: 30px;">
                <button class="btn btn-primary" onclick="checkAnswer()">×‘×“×•×§ ×ª×©×•×‘×”</button>
                <button class="btn btn-warning" onclick="showHint()">ğŸ’¡ ×¨××– (-5 × ×§')</button>
                <button class="btn btn-success" onclick="newQuestion()">×©××œ×” ×—×“×©×”</button>
                <button class="btn btn-info" onclick="showSolution()">×”×¦×’ ×¤×ª×¨×•×Ÿ (-10 × ×§')</button>
            </div>

            <!-- ××©×•×‘ -->
            <div class="feedback" id="feedback"></div>

            <!-- ×”×ª×§×“××•×ª -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0/10</div>
            </div>
        
        <div class="buttons-container" style="margin-top: 2rem;">
            <button class="btn btn-primary" onclick="newGame()">××©×—×§ ×—×“×©</button>
            <a href="index.html" class="btn btn-secondary" style="margin-right: 10px;">â†©ï¸ ×—×–×¨×” ×œ×ª×¤×¨×™×˜</a>
        </div>
    </div>
    </div>

    <script>
        // ××©×ª× ×™ ××©×—×§
        let currentLevel = 1;
        let score = 0;
        let streak = 0;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let questionsInLevel = 0;
        
        // ××©×ª× ×™ ×¦×™×¨
        let lineMin = 0;
        let lineMax = 10;
        let targetNumber = 5;
        let currentPosition = 5;
        let isDragging = false;
        let dragPoint = null;
        
        // ××ª×—×•×œ
        window.addEventListener('load', () => {
            loadProgress();
        });

        function selectLevel(level) {
            currentLevel = level;

            // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨×™×
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.closest('.mode-btn').classList.add('active');
        }

        function startGame() {
            // ×”×¡×ª×¨ ××¡×š ×”×’×“×¨×•×ª ×•×”×¦×’ ××ª ×”××©×—×§
            document.getElementById('gameSetup').style.display = 'none';
            document.getElementById('gameArea').style.display = 'block';

            // ××¤×¡ ××©×—×§
            score = 0;
            streak = 0;
            totalQuestions = 0;
            correctAnswers = 0;
            questionsInLevel = 0;

            // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
            document.getElementById('score').textContent = score;
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('streak').textContent = streak;
            document.getElementById('accuracy').textContent = '100';

            // ×§×‘×¢ ×˜×•×•×— ×œ×¤×™ ×¨××”
            setRangeByLevel();

            // ×”×ª×—×œ ××©×—×§
            initGame();
        }

        function newGame() {
            document.getElementById('gameSetup').style.display = 'block';
            document.getElementById('gameArea').style.display = 'none';
        }

        function initGame() {
            createNumberLine();
            newQuestion();
        }

        function setRangeByLevel() {
            switch(currentLevel) {
                case 1:
                    // ××¡×¤×¨×™× ×©×œ××™× 0-10
                    lineMin = 0;
                    lineMax = 10;
                    break;
                case 2:
                    // ××¡×¤×¨×™× ×©×œ××™× 0-20
                    lineMin = 0;
                    lineMax = 20;
                    break;
                case 3:
                    // ×¢×©×¨×•× ×™×™× 0-10
                    lineMin = 0;
                    lineMax = 10;
                    break;
                case 4:
                    // ×©×‘×¨×™× ×¤×©×•×˜×™×
                    lineMin = 0;
                    lineMax = 5;
                    break;
                case 5:
                    // ××¡×¤×¨×™× ×©×œ×™×œ×™×™× ×•×—×™×•×‘×™×™×
                    lineMin = -10;
                    lineMax = 10;
                    break;
            }
        }

        function createNumberLine() {
            const container = document.getElementById('numberLine');
            container.innerHTML = '<div class="line"></div>';
            
            // ×”×•×¡×£ ×—×¥ ×¨××– ×•××¨×§×¨ ××˜×¨×”
            const hintArrow = document.createElement('div');
            hintArrow.className = 'hint-arrow';
            hintArrow.id = 'hintArrow';
            hintArrow.textContent = 'â¬‡ï¸';
            container.appendChild(hintArrow);
            
            const targetMarker = document.createElement('div');
            targetMarker.className = 'target-marker';
            targetMarker.id = 'targetMarker';
            container.appendChild(targetMarker);
            
            // ××¡×¤×¨ ×”×¡×™××•× ×™×
            const ticks = lineMax - lineMin <= 10 ? lineMax - lineMin : 10;
            
            // ×™×¦×™×¨×ª ×¡×™××•× ×™×
            for (let i = 0; i <= ticks; i++) {
                const position = (i / ticks) * 100;
                const value = lineMin + (i / ticks) * (lineMax - lineMin);
                
                // ×¡×™××•×Ÿ
                const tick = document.createElement('div');
                tick.className = 'tick';
                tick.style.left = position + '%';
                container.appendChild(tick);
                
                // ×ª×•×•×™×ª - ×¨×§ ×œ××¡×¤×¨×™× ×©×œ××™× ××• × ×§×•×“×•×ª ×—×©×•×‘×•×ª
                if (value % 1 === 0 || i === 0 || i === ticks) {
                    const label = document.createElement('div');
                    label.className = 'tick-label';
                    label.style.left = position + '%';
                    label.textContent = formatNumber(value);
                    container.appendChild(label);
                }
            }
            
            // × ×§×•×“×” × ×™×™×“×ª
            const point = document.createElement('div');
            point.className = 'draggable-point';
            point.id = 'dragPoint';
            point.textContent = '?';
            point.style.left = '50%';
            container.appendChild(point);
            
            dragPoint = point;
            setupDragging(point, container);
        }

        function setupDragging(point, container) {
            // Mouse events
            point.addEventListener('mousedown', startDrag);
            document.addEventListener('mousemove', drag);
            document.addEventListener('mouseup', endDrag);
            
            // Touch events
            point.addEventListener('touchstart', startDrag);
            document.addEventListener('touchmove', drag);
            document.addEventListener('touchend', endDrag);
            
            function startDrag(e) {
                isDragging = true;
                point.classList.add('dragging');
                e.preventDefault();
            }
            
            function drag(e) {
                if (!isDragging) return;
                
                const rect = container.getBoundingClientRect();
                const x = (e.clientX || e.touches?.[0]?.clientX) - rect.left;
                const percentage = Math.max(0, Math.min(100, (x / rect.width) * 100));
                
                point.style.left = percentage + '%';
                currentPosition = lineMin + (percentage / 100) * (lineMax - lineMin);
                
                // ×¢×“×›×•×Ÿ ×ª×¦×•×’×”
                if (currentLevel === 4 && targetNumber.numerator) {
                    // ×ª×¦×•×’×ª ×©×‘×¨
                    const fraction = findClosestFraction(currentPosition);
                    point.innerHTML = `<div style="font-size: 0.6em"><div>${fraction.numerator}</div><div style="border-top: 1px solid white">${fraction.denominator}</div></div>`;
                } else {
                    point.textContent = formatNumber(currentPosition);
                }
            }
            
            function endDrag() {
                isDragging = false;
                point.classList.remove('dragging');
            }
        }

        function newQuestion() {
            // ××™×¤×•×¡ ×¨××–×™×
            document.getElementById('hintArrow').classList.remove('show');
            document.getElementById('targetMarker').classList.remove('show');
            
            // ×™×¦×™×¨×ª ×©××œ×” ×œ×¤×™ ×¨××”
            switch(currentLevel) {
                case 1:
                    // ××¡×¤×¨×™× ×©×œ××™× 0-10
                    targetNumber = Math.floor(Math.random() * 11);
                    break;
                case 2:
                    // ××¡×¤×¨×™× ×©×œ××™× 0-20
                    targetNumber = Math.floor(Math.random() * 21);
                    break;
                case 3:
                    // ×¢×©×¨×•× ×™×™×
                    targetNumber = (Math.floor(Math.random() * 100) / 10);
                    break;
                case 4:
                    // ×©×‘×¨×™×
                    const denominators = [2, 3, 4, 5, 6, 8];
                    const denominator = denominators[Math.floor(Math.random() * denominators.length)];
                    const numerator = Math.floor(Math.random() * (denominator * lineMax)) + 1;
                    targetNumber = {
                        numerator: numerator,
                        denominator: denominator,
                        value: numerator / denominator
                    };
                    break;
                case 5:
                    // ××¡×¤×¨×™× ×©×œ×™×œ×™×™×
                    targetNumber = Math.floor(Math.random() * 21) - 10;
                    break;
            }
            
            // ×¢×“×›×•×Ÿ ×©××œ×”
            updateQuestion();
            
            // ××ª×—×•×œ ×¦×™×¨
            createNumberLine();
        }

        function updateQuestion() {
            const questionEl = document.getElementById('question');
            
            if (currentLevel === 4 && targetNumber.numerator) {
                // ×ª×¦×•×’×ª ×©×‘×¨
                questionEl.innerHTML = `
                    ××§× ××ª ×”×©×‘×¨ 
                    <span class="fraction-display">
                        <div class="fraction-numerator">${targetNumber.numerator}</div>
                        <div class="fraction-denominator">${targetNumber.denominator}</div>
                    </span>
                    ×¢×œ ×¦×™×¨ ×”××¡×¤×¨×™×
                `;
            } else {
                questionEl.innerHTML = `
                    ××§× ××ª ×”××¡×¤×¨ <span class="highlight">${formatNumber(targetNumber)}</span> ×¢×œ ×¦×™×¨ ×”××¡×¤×¨×™×
                `;
            }
        }

        function checkAnswer() {
            totalQuestions++;
            questionsInLevel++;
            
            // ×—×™×©×•×‘ ×“×™×•×§
            let targetValue = targetNumber.value || targetNumber;
            let tolerance = (lineMax - lineMin) * 0.05; // 5% ×¡×•×‘×œ× ×•×ª
            
            if (currentLevel === 4) {
                tolerance = 0.1; // ×¡×•×‘×œ× ×•×ª ×§×˜× ×” ×™×•×ª×¨ ×œ×©×‘×¨×™×
            }
            
            const isCorrect = Math.abs(currentPosition - targetValue) <= tolerance;
            
            if (isCorrect) {
                correctAnswers++;
                streak++;
                let points = 10 * currentLevel;
                
                // ×‘×•× ×•×¡ ×¨×¦×£
                if (streak >= 3) {
                    points += streak * 2;
                }
                
                score += points;
                showFeedback(`ğŸ¯ ××“×•×™×§! +${points} × ×§×•×“×•×ª`, 'correct');
                
                // ×× ×™××¦×™×” ×©×œ ×”×¦×œ×—×”
                dragPoint.classList.add('correct');
                dragPoint.textContent = 'âœ“';
                
                // ×”××©×š ×œ×©××œ×” ×”×‘××”
                setTimeout(() => {
                    if (questionsInLevel >= 10) {
                        levelComplete();
                    } else {
                        newQuestion();
                    }
                }, 2000);
            } else {
                streak = 0;
                const distance = Math.abs(currentPosition - targetValue).toFixed(2);
                showFeedback(`âŒ ×œ× ××“×•×™×§. ×”××¨×—×§: ${distance}`, 'incorrect');
                
                // ×”×¦×’ ××™×§×•× × ×›×•×Ÿ
                showCorrectPosition();
            }
            
            updateStats();
            updateProgress();
        }

        function showHint() {
            score = Math.max(0, score - 5);
            updateStats();
            
            const targetValue = targetNumber.value || targetNumber;
            const targetPercentage = ((targetValue - lineMin) / (lineMax - lineMin)) * 100;
            
            // ×”×¦×’ ×—×¥
            const arrow = document.getElementById('hintArrow');
            arrow.style.left = targetPercentage + '%';
            arrow.classList.add('show');
            
            // ×¨××– ×›×™×•×•×Ÿ
            const direction = targetValue > currentPosition ? 'ğŸ‘ˆ ×–×•×– ×©×××œ×”' : 'ğŸ‘‰ ×–×•×– ×™××™× ×”';
            showFeedback(direction, 'correct');
        }

        function showSolution() {
            score = Math.max(0, score - 10);
            updateStats();
            
            showCorrectPosition();
            showFeedback('×”×¤×ª×¨×•×Ÿ ××•×¦×’ ×‘×™×¨×•×§', 'correct');
        }

        function showCorrectPosition() {
            const targetValue = targetNumber.value || targetNumber;
            const targetPercentage = ((targetValue - lineMin) / (lineMax - lineMin)) * 100;
            
            // ×”×¦×’ ××¨×§×¨
            const marker = document.getElementById('targetMarker');
            marker.style.left = targetPercentage + '%';
            marker.classList.add('show');
            
            // ×”×•×¡×£ × ×§×•×“×” × ×›×•× ×”
            const correctPoint = document.createElement('div');
            correctPoint.className = 'draggable-point correct';
            correctPoint.style.left = targetPercentage + '%';
            
            if (currentLevel === 4 && targetNumber.numerator) {
                correctPoint.innerHTML = `<div style="font-size: 0.6em"><div>${targetNumber.numerator}</div><div style="border-top: 1px solid white">${targetNumber.denominator}</div></div>`;
            } else {
                correctPoint.textContent = formatNumber(targetValue);
            }
            
            document.getElementById('numberLine').appendChild(correctPoint);
        }

        function levelComplete() {
            showFeedback(`ğŸŠ ×¡×™×™××ª ×¨××” ${currentLevel}! ×¢×•×‘×¨ ×œ×¨××” ${currentLevel + 1}`, 'correct');
            
            if (currentLevel < 5) {
                currentLevel++;
                questionsInLevel = 0;
                
                // ×¢×“×›×•×Ÿ ×›×¤×ª×•×¨ ×¨××”
                document.querySelectorAll('.level-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                document.querySelectorAll('.level-btn')[currentLevel - 1].classList.add('active');
                
                setRangeByLevel();
                setTimeout(() => newQuestion(), 2000);
            } else {
                gameComplete();
            }
        }

        function gameComplete() {
            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ† ×›×œ ×”×›×‘×•×“! ğŸ†</h2>
                    <p>×¡×™×™××ª ××ª ×›×œ ×”×¨××•×ª!</p>
                    <div class="grade-circle excellent">${score}</div>
                    <p>×“×™×•×§: ${accuracy}%</p>
                    
                    
                </div>
            `;
            document.body.appendChild(modal);
            
            saveProgress();
        }

        function formatNumber(num) {
            if (typeof num === 'object' && num.numerator) {
                return `${num.numerator}/${num.denominator}`;
            }
            if (num % 1 === 0) {
                return num.toString();
            }
            return num.toFixed(1);
        }

        function findClosestFraction(decimal) {
            const fractions = [
                {numerator: 1, denominator: 2},
                {numerator: 1, denominator: 3},
                {numerator: 2, denominator: 3},
                {numerator: 1, denominator: 4},
                {numerator: 3, denominator: 4},
                {numerator: 1, denominator: 5},
                {numerator: 2, denominator: 5},
                {numerator: 3, denominator: 5},
                {numerator: 4, denominator: 5}
            ];
            
            let closest = fractions[0];
            let minDiff = Math.abs(decimal - (closest.numerator / closest.denominator));
            
            fractions.forEach(f => {
                const diff = Math.abs(decimal - (f.numerator / f.denominator));
                if (diff < minDiff) {
                    minDiff = diff;
                    closest = f;
                }
            });
            
            return closest;
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback show ${type}`;
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('streak').textContent = streak;
            
            const accuracy = totalQuestions > 0 ? 
                Math.round((correctAnswers / totalQuestions) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy;
        }

        function updateProgress() {
            const progress = (questionsInLevel / 10) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${questionsInLevel}/10`;
        }

        function saveProgress() {
            localStorage.setItem('numberline_score', score);
            localStorage.setItem('numberline_level', currentLevel);
            localStorage.setItem('numberline_accuracy', 
                Math.round((correctAnswers / totalQuestions) * 100));
        }

        function loadProgress() {
            const savedScore = localStorage.getItem('numberline_score');
            if (savedScore) {
                score = parseInt(savedScore);
                updateStats();
            }
        }
    </script>
</body>
</html>