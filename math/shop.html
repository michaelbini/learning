<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>×—× ×•×ª ×”××ª××˜×™×§×” - ×›×™×ª×” ×”'</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="game-container">
        <h1>ğŸ›’ ××©×—×§ ×”×—× ×•×ª ğŸ›’</h1>
        
        
        <!-- Game Setup -->
        <div id="gameSetup">
            <div class="instructions">
                <strong>ğŸ“– ×”×•×¨××•×ª ×”××©×—×§:</strong><br>
                × ×”×œ ×—× ×•×ª ×•×—×©×‘ ×›×¡×£ ×•×¢×•×“×£.<br>×‘×—×¨ ×¨××ª ×§×•×©×™ ×•×”×ª×—×œ ×œ×©×—×§!
            </div>

            <div class="game-modes">

                <button type="button" class="mode-btn active" onclick="selectLevel(1)">
                    <span class="mode-icon">ğŸ˜Š</span>
                    <span>×¨××” 1</span>

                </button>
                <button type="button" class="mode-btn " onclick="selectLevel(2)">
                    <span class="mode-icon">ğŸ¯</span>
                    <span>×¨××” 2</span>

                </button>
                <button type="button" class="mode-btn " onclick="selectLevel(3)">
                    <span class="mode-icon">ğŸ’ª</span>
                    <span>×¨××” 3</span>

                </button>
                <button type="button" class="mode-btn " onclick="selectLevel(4)">
                    <span class="mode-icon">ğŸ”¥</span>
                    <span>×¨××” 4</span>

                </button>
                <button type="button" class="mode-btn " onclick="selectLevel(5)">
                    <span class="mode-icon">ğŸš€</span>
                    <span>×¨××” 5</span>

                </button>
            </div>

            <div class="buttons-container">
                <button type="button" class="btn btn-primary" onclick="startGame()">×”×ª×—×œ ××©×—×§</button>
            </div>
        </div>

        <!-- Game Area -->
        <div id="gameArea" style="display: none;"><!-- ×œ×•×— × ×™×§×•×“ -->
            <div class="score-board">
                <div class="score-item">
                    <div class="score-label">× ×§×•×“×•×ª</div>
                    <div class="score-value" id="score">0</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨××”</div>
                    <div class="score-value" id="currentLevel">1</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×“×™×•×§</div>
                    <div class="score-value"><span id="accuracy">100</span>%</div>
                </div>
                <div class="score-item">
                    <div class="score-label">×¨×¦×£</div>
                    <div class="score-value" id="streak">0</div>
                </div>
            </div>

            <!-- ××¨× ×§ -->
            <div class="wallet-display">
                <div style="font-size: 1.2em; margin-bottom: 10px;">ğŸ’° ×”×›×¡×£ ×©×œ×š:</div>
                <div class="wallet-amount">â‚ª<span id="walletAmount">50.00</span></div>
            </div>

            <!-- ×©××œ×” -->
            <div class="question-display" id="question">
                ×§× ×” ××•×¦×¨×™× ××”×—× ×•×ª ×•×ª×Ÿ ××ª ×”×¢×•×“×£ ×”× ×›×•×Ÿ
            </div>

            <!-- ×—× ×•×ª -->
            <div class="shop-container" id="shopContainer">
                <!-- ××•×¦×¨×™× ×™×™×•×•×¦×¨×• ×“×™× ××™×ª -->
            </div>

            <!-- ×¢×’×œ×” -->
            <div class="cart-container">
                <div class="cart-header">
                    <div class="cart-title">ğŸ›’ ×”×¢×’×œ×” ×©×œ×š</div>
                    <button type="button" class="btn btn-warning btn-sm" onclick="clearCart()">× ×§×” ×¢×’×œ×”</button>
                </div>
                <div class="cart-items" id="cartItems">
                    <div style="text-align: center; color: #999;">×”×¢×’×œ×” ×¨×™×§×”</div>
                </div>
                <div class="cart-total">
                    ×¡×”"×›: â‚ª<span id="cartTotal">0.00</span>
                </div>
                
                <!-- ×—×™×©×•×‘ ×¢×•×“×£ -->
                <div style="text-align: center; margin-top: 20px;">
                    <label for="changeInput" style="font-size: 1.2em; margin-bottom: 10px; display: block;">
                        ×›××” ×¢×•×“×£ ×ª×§×‘×œ?
                    </label>
                    <input type="number" class="change-input" id="changeInput" name="change" step="0.01" placeholder="0.00">
                </div>
            </div>

            <!-- ×§×‘×œ×” -->
            <div class="receipt" id="receipt" style="display: none;">
                <div class="receipt-header">ğŸ§¾ ×§×‘×œ×”</div>
                <div id="receiptContent"></div>
            </div>

            <!-- ×›×¤×ª×•×¨×™× -->
            <div style="text-align: center; margin-top: 30px;">
                <button type="button" class="btn btn-primary" onclick="checkAnswer()">×‘×“×•×§ ×ª×©×•×‘×”</button>
                <button type="button" class="btn btn-success" onclick="newRound()">×¡×™×‘×•×‘ ×—×“×©</button>
                <button type="button" class="btn btn-info" onclick="showHint()" aria-label="×¨××–">ğŸ’¡ ×¨××– (-5 × ×§')</button>
            </div>

            <!-- ××©×•×‘ -->
            <div class="feedback" id="feedback"></div>

            <!-- ×”×ª×§×“××•×ª -->
            <div class="progress-bar-container">
                <div class="progress-bar" id="progressBar" style="width: 0%">0/10</div>
            </div>
        </div>

    </div>

        
        

    <script>
        // ××•×¦×¨×™× ×œ×—× ×•×ª
        const products = {
            school: [
                {name: '×¢×™×¤×¨×•×Ÿ', icon: 'âœï¸', basePrice: 2.50},
                {name: '××—×‘×¨×ª', icon: 'ğŸ““', basePrice: 8.90},
                {name: '××—×§', icon: 'ğŸ§½', basePrice: 3.75},
                {name: '×¡×¨×’×œ', icon: 'ğŸ“', basePrice: 6.20},
                {name: '×“×‘×§', icon: 'ğŸ“Œ', basePrice: 4.50},
                {name: '×¦×‘×¢×™×', icon: 'ğŸ–ï¸', basePrice: 15.80},
                {name: '×§×œ××¨', icon: 'ğŸ’', basePrice: 22.30},
                {name: '××¡×¤×¨×™×™×', icon: 'âœ‚ï¸', basePrice: 9.90}
            ],
            food: [
                {name: '×œ×—×', icon: 'ğŸ', basePrice: 5.90},
                {name: '×—×œ×‘', icon: 'ğŸ¥›', basePrice: 6.40},
                {name: '×ª×¤×•×—', icon: 'ğŸ', basePrice: 2.30},
                {name: '×’×‘×™× ×”', icon: 'ğŸ§€', basePrice: 12.50},
                {name: '×‘×™×¦×™×', icon: 'ğŸ¥š', basePrice: 14.90},
                {name: '×¢×’×‘× ×™×™×”', icon: 'ğŸ…', basePrice: 3.80},
                {name: '×‘× × ×”', icon: 'ğŸŒ', basePrice: 4.20},
                {name: '×œ×—×× ×™×™×”', icon: 'ğŸ¥–', basePrice: 1.50}
            ]
        };

        // ××©×ª× ×™ ××©×—×§
        let currentLevel = 1;
        let score = 0;
        let streak = 0;
        let totalQuestions = 0;
        let correctAnswers = 0;
        let questionsInLevel = 0;
        
        // ××©×ª× ×™ ×—× ×•×ª
        let walletAmount = 50;
        let cart = [];
        let cartTotal = 0;
        let correctChange = 0;
        let currentProducts = [];
        
        // ××ª×—×•×œ
        window.addEventListener('load', () => {
            loadProgress();
        });

        function initGame() {
            generateProducts();
            updateDisplay();
        }

        function selectLevel(level, button) {
            currentLevel = level;
            questionsInLevel = 0;
            
            document.querySelectorAll('.level-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            button.classList.add('active');
            
            document.getElementById('currentLevel').textContent = level;
            
            // ×§×‘×¢ ××¨× ×§ ×œ×¤×™ ×¨××”
            switch(level) {
                case 1:
                    walletAmount = 50;
                    break;
                case 2:
                    walletAmount = 100;
                    break;
                case 3:
                    walletAmount = 75.50;
                    break;
                case 4:
                    walletAmount = 123.45;
                    break;
                case 5:
                    walletAmount = 200.75;
                    break;
            }
            
            newRound();
        }

        function generateProducts() {
            const container = document.getElementById('shopContainer');
            container.innerHTML = '';
            
            // ×‘×—×¨ ×§×˜×’×•×¨×™×”
            const category = Math.random() < 0.5 ? 'school' : 'food';
            const productList = products[category];
            
            // ××¡×¤×¨ ××•×¦×¨×™× ×œ×¤×™ ×¨××”
            const numProducts = Math.min(4 + currentLevel, 8);
            currentProducts = [];
            
            // ×¢×¨×‘×‘ ×•×§×— ××•×¦×¨×™×
            const shuffled = [...productList].sort(() => Math.random() - 0.5);
            
            for (let i = 0; i < numProducts; i++) {
                const product = {...shuffled[i]};
                
                // ×§×‘×¢ ××—×™×¨ ×œ×¤×™ ×¨××”
                if (currentLevel === 1) {
                    // ××—×™×¨×™× ×©×œ××™×
                    product.price = Math.round(product.basePrice);
                } else if (currentLevel === 2) {
                    // ××—×™×¨×™× ×¢× 50 ××’×•×¨×•×ª
                    product.price = Math.round(product.basePrice * 2) / 2;
                } else if (currentLevel === 3) {
                    // ××—×™×¨×™× ×¢× ×¢×©×™×¨×™×•×ª
                    product.price = Math.round(product.basePrice * 10) / 10;
                } else {
                    // ××—×™×¨ ××œ×
                    product.price = product.basePrice;
                }
                
                // ×”× ×—×•×ª ×‘×¨××•×ª ×’×‘×•×”×•×ª
                if (currentLevel >= 4 && Math.random() < 0.3) {
                    product.discount = [10, 20, 25, 30][Math.floor(Math.random() * 4)];
                    product.originalPrice = product.price;
                    product.price = product.price * (1 - product.discount / 100);
                    product.price = Math.round(product.price * 100) / 100;
                }
                
                currentProducts.push(product);
                
                // ×¦×•×¨ ××œ×× ×˜ ××•×¦×¨
                const item = document.createElement('div');
                item.className = 'shop-item';
                item.onclick = () => toggleItem(i);
                item.id = `item-${i}`;
                
                if (product.discount) {
                    item.innerHTML = `
                        <div class="item-discount">-${product.discount}%</div>
                        <div class="item-icon">${product.icon}</div>
                        <div class="item-name">${product.name}</div>
                        <div style="text-decoration: line-through; color: #999;">â‚ª${product.originalPrice.toFixed(2)}</div>
                        <div class="item-price">â‚ª${product.price.toFixed(2)}</div>
                    `;
                } else {
                    item.innerHTML = `
                        <div class="item-icon">${product.icon}</div>
                        <div class="item-name">${product.name}</div>
                        <div class="item-price">â‚ª${product.price.toFixed(2)}</div>
                    `;
                }
                
                // ×›××•×ª ×‘×¨××•×ª ×’×‘×•×”×•×ª
                if (currentLevel >= 3) {
                    const quantityDiv = document.createElement('div');
                    quantityDiv.className = 'quantity-selector';
                    quantityDiv.innerHTML = `
                        <button class="quantity-btn" onclick="changeQuantity(${i}, -1, event)">-</button>
                        <span class="quantity-display" id="qty-${i}">0</span>
                        <button class="quantity-btn" onclick="changeQuantity(${i}, 1, event)">+</button>
                    `;
                    item.appendChild(quantityDiv);
                }
                
                container.appendChild(item);
            }
        }

        function toggleItem(index) {
            const product = currentProducts[index];
            const item = document.getElementById(`item-${index}`);
            const existingIndex = cart.findIndex(p => p.name === product.name);
            
            if (existingIndex >= 0) {
                // ×”×¡×¨ ××”×¢×’×œ×”
                cart.splice(existingIndex, 1);
                item.classList.remove('in-cart');
                if (currentLevel >= 3) {
                    document.getElementById(`qty-${index}`).textContent = '0';
                }
            } else {
                // ×”×•×¡×£ ×œ×¢×’×œ×”
                const quantity = currentLevel >= 3 ? 
                    parseInt(document.getElementById(`qty-${index}`).textContent) || 1 : 1;
                cart.push({...product, quantity});
                item.classList.add('in-cart');
            }
            
            updateCart();
        }

        function changeQuantity(index, delta, event) {
            event.stopPropagation();
            
            const qtyDisplay = document.getElementById(`qty-${index}`);
            let quantity = parseInt(qtyDisplay.textContent) || 0;
            quantity = Math.max(0, Math.min(10, quantity + delta));
            qtyDisplay.textContent = quantity;
            
            const product = currentProducts[index];
            const existingIndex = cart.findIndex(p => p.name === product.name);
            
            if (quantity > 0) {
                if (existingIndex >= 0) {
                    cart[existingIndex].quantity = quantity;
                } else {
                    cart.push({...product, quantity});
                    document.getElementById(`item-${index}`).classList.add('in-cart');
                }
            } else if (existingIndex >= 0) {
                cart.splice(existingIndex, 1);
                document.getElementById(`item-${index}`).classList.remove('in-cart');
            }
            
            updateCart();
        }

        function updateCart() {
            const container = document.getElementById('cartItems');
            
            if (cart.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #999;">×”×¢×’×œ×” ×¨×™×§×”</div>';
                cartTotal = 0;
            } else {
                container.innerHTML = '';
                cartTotal = 0;
                
                cart.forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'cart-item';
                    
                    const quantity = item.quantity || 1;
                    const itemTotal = item.price * quantity;
                    cartTotal += itemTotal;
                    
                    itemDiv.innerHTML = `
                        <span>${item.icon} ${item.name} ${quantity > 1 ? `Ã—${quantity}` : ''}</span>
                        <span>â‚ª${itemTotal.toFixed(2)}</span>
                    `;
                    
                    container.appendChild(itemDiv);
                });
            }
            
            document.getElementById('cartTotal').textContent = cartTotal.toFixed(2);
            correctChange = walletAmount - cartTotal;
        }

        function clearCart() {
            cart = [];
            document.querySelectorAll('.shop-item').forEach(item => {
                item.classList.remove('in-cart');
            });
            if (currentLevel >= 3) {
                document.querySelectorAll('.quantity-display').forEach(qty => {
                    qty.textContent = '0';
                });
            }
            updateCart();
        }

        function checkAnswer() {
            if (cart.length === 0) {
                showFeedback('â— ×‘×—×¨ ××•×¦×¨×™× ××”×—× ×•×ª ×§×•×“×', 'incorrect');
                return;
            }
            
            totalQuestions++;
            questionsInLevel++;
            
            const userChange = parseFloat(document.getElementById('changeInput').value) || 0;
            const isCorrect = Math.abs(userChange - correctChange) < 0.01;
            
            if (isCorrect) {
                correctAnswers++;
                streak++;
                let points = 10 * currentLevel;
                
                if (streak >= 3) {
                    points += streak * 2;
                }
                
                score += points;
                showFeedback(`ğŸ¯ × ×›×•×Ÿ! ×”×¢×•×“×£ ×”×•× â‚ª${correctChange.toFixed(2)}. +${points} × ×§×•×“×•×ª`, 'correct');
                showReceipt();
                
                setTimeout(() => {
                    if (questionsInLevel >= 10) {
                        levelComplete();
                    } else {
                        newRound();
                    }
                }, 3000);
            } else {
                streak = 0;
                showFeedback(`âŒ ×œ× × ×›×•×Ÿ. ×”×¢×•×“×£ ×”× ×›×•×Ÿ ×”×•× â‚ª${correctChange.toFixed(2)}`, 'incorrect');
                showReceipt();
            }
            
            updateStats();
            updateProgress();
        }

        function showReceipt() {
            const receipt = document.getElementById('receipt');
            const content = document.getElementById('receiptContent');
            
            let html = '';
            cart.forEach(item => {
                const quantity = item.quantity || 1;
                const itemTotal = item.price * quantity;
                html += `
                    <div class="receipt-line">
                        <span>${item.name} ${quantity > 1 ? `Ã—${quantity}` : ''}</span>
                        <span>â‚ª${itemTotal.toFixed(2)}</span>
                    </div>
                `;
            });
            
            html += `
                <div class="receipt-total">
                    <div class="receipt-line">
                        <span>×¡×”"×›:</span>
                        <span>â‚ª${cartTotal.toFixed(2)}</span>
                    </div>
                    <div class="receipt-line">
                        <span>×©×•×œ×:</span>
                        <span>â‚ª${walletAmount.toFixed(2)}</span>
                    </div>
                    <div class="receipt-line" style="color: var(--success-color);">
                        <span>×¢×•×“×£:</span>
                        <span>â‚ª${correctChange.toFixed(2)}</span>
                    </div>
                </div>
            `;
            
            content.innerHTML = html;
            receipt.style.display = 'block';
        }

        function newRound() {
            // ××™×¤×•×¡
            clearCart();
            document.getElementById('changeInput').value = '';
            document.getElementById('receipt').style.display = 'none';
            
            // ××¨× ×§ ×—×“×©
            if (currentLevel <= 2) {
                walletAmount = 50 + Math.floor(Math.random() * 50);
            } else if (currentLevel === 3) {
                walletAmount = 50 + Math.random() * 50;
                walletAmount = Math.round(walletAmount * 2) / 2;
            } else {
                walletAmount = 100 + Math.random() * 100;
                walletAmount = Math.round(walletAmount * 100) / 100;
            }
            
            document.getElementById('walletAmount').textContent = walletAmount.toFixed(2);
            
            // ××•×¦×¨×™× ×—×“×©×™×
            generateProducts();
            
            // ×©××œ×” ×œ×¤×™ ×¨××”
            if (currentLevel === 1) {
                document.getElementById('question').textContent = '×§× ×” ××•×¦×¨×™× ×•×ª×—×©×‘ ××ª ×”×¢×•×“×£';
            } else if (currentLevel === 2) {
                document.getElementById('question').textContent = '×§× ×” ×œ×¤×—×•×ª 3 ××•×¦×¨×™× ×•×ª×—×©×‘ ××ª ×”×¢×•×“×£';
            } else if (currentLevel === 3) {
                document.getElementById('question').textContent = '×§× ×” ××•×¦×¨×™× ×‘×›××•×™×•×ª ×©×•× ×•×ª ×•×ª×—×©×‘ ××ª ×”×¢×•×“×£';
            } else if (currentLevel === 4) {
                document.getElementById('question').textContent = '× ×¦×œ ××ª ×”×”× ×—×•×ª ×•×—×©×‘ ××ª ×”×¢×•×“×£ ×”××“×•×™×§';
            } else {
                document.getElementById('question').textContent = '×ª×›× ×Ÿ ×§× ×™×™×” ×—×›××” ×•×—×©×‘ ××ª ×”×¢×•×“×£';
            }
        }

        function showHint() {
            score = Math.max(0, score - 5);
            updateStats();
            
            const hint = `ğŸ’¡ ×”××¨× ×§: â‚ª${walletAmount.toFixed(2)} | ×”×¢×’×œ×”: â‚ª${cartTotal.toFixed(2)}`;
            showFeedback(hint, 'correct');
        }

        function levelComplete() {
            showFeedback(`ğŸŠ ×¡×™×™××ª ×¨××” ${currentLevel}!`, 'correct');
            
            if (currentLevel < 5) {
                currentLevel++;
                questionsInLevel = 0;
                selectLevel(currentLevel, document.querySelectorAll('.level-btn')[currentLevel - 1]);
            } else {
                gameComplete();
            }
        }

        function gameComplete() {
            const accuracy = Math.round((correctAnswers / totalQuestions) * 100);
            
            const modal = document.createElement('div');
            modal.className = 'modal show';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ† ×›×œ ×”×›×‘×•×“! ğŸ†</h2>
                    <p>×¡×™×™××ª ××ª ×›×œ ×”×¨××•×ª!</p>
                    <div class="grade-circle excellent">${score}</div>
                    <p>×“×™×•×§: ${accuracy}%</p>
                    
                    <button class="btn btn-secondary" onclick="location.href='index.html'">×—×–×¨×” ×œ×¢××•×“ ×”×¨××©×™</button>
                </div>
            `;
            document.body.appendChild(modal);
            
            saveProgress();
        }

        function showFeedback(message, type) {
            const feedback = document.getElementById('feedback');
            feedback.textContent = message;
            feedback.className = `feedback show ${type}`;
            
            setTimeout(() => {
                feedback.classList.remove('show');
            }, 3000);
        }

        function updateStats() {
            document.getElementById('score').textContent = score;
            document.getElementById('currentLevel').textContent = currentLevel;
            document.getElementById('streak').textContent = streak;
            
            const accuracy = totalQuestions > 0 ? 
                Math.round((correctAnswers / totalQuestions) * 100) : 100;
            document.getElementById('accuracy').textContent = accuracy;
        }

        function updateDisplay() {
            updateStats();
            document.getElementById('walletAmount').textContent = walletAmount.toFixed(2);
        }

        function updateProgress() {
            const progress = (questionsInLevel / 10) * 100;
            const progressBar = document.getElementById('progressBar');
            progressBar.style.width = progress + '%';
            progressBar.textContent = `${questionsInLevel}/10`;
        }

        function saveProgress() {
            localStorage.setItem('shop_score', score);
            localStorage.setItem('shop_level', currentLevel);
        }

        function loadProgress() {
            const savedScore = localStorage.getItem('shop_score');
            if (savedScore) {
                score = parseInt(savedScore);
                updateStats();
            }
        }
    </script>
</body>
</html>