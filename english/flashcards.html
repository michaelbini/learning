<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>××©×—×§ ×§×œ×¤×™ ××•×¦×¨ ××™×œ×™×</title>
    <script src="lesson-manager.js" onerror="console.log('lesson-manager.js not found, using basic mode')"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            text-align: center;
            max-width: 600px;
            width: 100%;
        }

        h1 {
            color: white;
            margin-bottom: 30px;
            font-size: 2.5em;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .card-container {
            perspective: 1000px;
            margin-bottom: 30px;
        }

        .card {
            width: 100%;
            height: 350px;
            position: relative;
            transform-style: preserve-3d;
            transition: transform 0.6s;
            cursor: pointer;
            transform: rotateY(0deg);
        }

        .card.flipped {
            transform: rotateY(180deg);
        }

        .card-face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5em;
            font-weight: bold;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            padding: 40px;
        }

        .card-front {
            background: linear-gradient(135deg, #ffffff 0%, #f0f0f0 100%);
            color: #333;
            z-index: 2;
            transform: rotateY(0deg);
        }

        .card-back {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            transform: rotateY(180deg);
            z-index: 1;
        }

        .controls {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 15px 30px;
            font-size: 1.1em;
            border: none;
            border-radius: 10px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .btn-next {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }

        .btn-flip {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }

        .btn-shuffle {
            background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);
            color: white;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0,0,0,0.3);
        }

        button:active {
            transform: translateY(0);
        }

        .progress {
            color: white;
            font-size: 1.3em;
            margin-bottom: 20px;
            background: rgba(255,255,255,0.2);
            padding: 15px;
            border-radius: 10px;
            backdrop-filter: blur(10px);
        }

        .hint {
            color: rgba(255,255,255,0.9);
            font-size: 1.1em;
            margin-top: 20px;
            font-style: italic;
        }

        @media (max-width: 600px) {
            h1 {
                font-size: 1.8em;
            }
            
            .card-face {
                font-size: 1.8em;
                padding: 20px;
            }
            
            button {
                padding: 12px 20px;
                font-size: 1em;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ´ ××©×—×§ ×§×œ×¤×™ ××•×¦×¨ ××™×œ×™× - Flashcards</h1>
        
        <div id="lessonSelector" style="text-align: center; margin-bottom: 20px;"></div>
        
        <div class="progress">
            <span id="progress">×§×œ×£ 1 ××ª×•×š 63</span>
        </div>

        <div style="display: flex; justify-content: center; gap: 20px; margin-bottom: 20px;">
            <div style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                <span style="color: white; font-size: 1.2em;">âœ… ×¦×“×§×ª×™: <strong id="correctScore">0</strong></span>
            </div>
            <div style="background: rgba(255,255,255,0.2); padding: 10px 20px; border-radius: 10px; backdrop-filter: blur(10px);">
                <span style="color: white; font-size: 1.2em;">âŒ ×˜×¢×™×ª×™: <strong id="wrongScore">0</strong></span>
            </div>
        </div>

        <div class="card-container">
            <div class="card" id="card" onclick="flipCard()">
                <div class="card-face card-front" id="front">
                    <span id="question"></span>
                </div>
                <div class="card-face card-back" id="back">
                    <span id="answer"></span>
                </div>
            </div>
        </div>

        <div class="controls">
            <button class="btn-flip" onclick="flipCard()">ğŸ”„ ×”×¤×•×š ×§×œ×£</button>
        </div>

        <div class="controls" id="answerButtons" style="margin-top: 10px;">
            <button style="background: linear-gradient(135deg, #11998e 0%, #38ef7d 100%); color: white; padding: 15px 30px; font-size: 1.1em; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" onclick="markAnswer(true)">
                âœ… ×¦×“×§×ª×™
            </button>
            <button style="background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; padding: 15px 30px; font-size: 1.1em; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; transition: all 0.3s; box-shadow: 0 4px 15px rgba(0,0,0,0.2);" onclick="markAnswer(false)">
                âŒ ×˜×¢×™×ª×™
            </button>
        </div>

        <div class="controls" style="margin-top: 20px;">
            <button class="btn-shuffle" onclick="shuffleCards()">ğŸ”€ ×¢×¨×‘×‘</button>
        </div>

        <div class="hint">
            ğŸ’¡ ×œ×—×¥ ×¢×œ ×”×§×œ×£ ×›×“×™ ×œ×¨××•×ª ××ª ×”×ª×¨×’×•×
        </div>

        <div id="finalScreen" style="display: none; background: white; border-radius: 20px; padding: 40px; margin-top: 20px; text-align: center;">
            <h2 style="color: #667eea; font-size: 2.5em; margin-bottom: 20px;">ğŸ‰ ×¡×™×™××ª!</h2>
            <div style="font-size: 1.5em; margin: 20px 0; color: #333;">
                <div style="margin: 10px 0;">âœ… ×¦×“×§×ª×™: <strong style="color: #11998e; font-size: 1.5em;" id="finalCorrect">0</strong></div>
                <div style="margin: 10px 0;">âŒ ×˜×¢×™×ª×™: <strong style="color: #eb3349; font-size: 1.5em;" id="finalWrong">0</strong></div>
            </div>
            <div style="margin-top: 30px;">
                <button onclick="restartGame()" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin: 5px;">
                    ğŸ”„ ×©×—×§ ×©×•×‘ (×›×œ ×”××™×œ×™×)
                </button>
                <button id="retryWrongBtn" onclick="retryWrongCards()" style="display: none; background: linear-gradient(135deg, #eb3349 0%, #f45c43 100%); color: white; padding: 15px 30px; font-size: 1.2em; border: none; border-radius: 10px; cursor: pointer; font-weight: bold; margin: 5px;">
                    ğŸ’ª ×ª×¨×’×œ ×¨×§ ××™×œ×™× ×©×˜×¢×™×ª×™
                </button>
            </div>
        </div>
    </div>

    <script>
        // ============================================
        // JSON ××•×˜××¢ (×‘×¨×™×¨×ª ××—×“×œ)
        // ============================================
        const EMBEDDED_VOCABULARY = [
            { "english": "area", "hebrew": "××–×•×¨", "lesson": 1 },
            { "english": "accompany", "hebrew": "×œ×œ×•×•×ª", "lesson": 1 },
            { "english": "bridge", "hebrew": "×’×©×¨", "lesson": 1 },
            { "english": "certain", "hebrew": "×‘×˜×•×—, ×•×“××™" },
            { "english": "danger", "hebrew": "×¡×›× ×”" },
            { "english": "dangerous", "hebrew": "××¡×•×›×Ÿ" },
            { "english": "improve", "hebrew": "×œ×©×¤×¨" },
            { "english": "imagine", "hebrew": "×œ×“××™×™×Ÿ" },
            { "english": "in fact", "hebrew": "×œ××¢×©×”, ×‘×¢×¦×" },
            { "english": "kilometer", "hebrew": "×§×™×œ×•××˜×¨" },
            { "english": "manage (to)", "hebrew": "×œ×”×¦×œ×™×— ×œ" },
            { "english": "article", "hebrew": "××××¨" },
            { "english": "be worth it", "hebrew": "×œ×”×™×•×ª ×©×•×•×”" },
            { "english": "blood", "hebrew": "×“×" },
            { "english": "common", "hebrew": "× ×¤×•×¥, ××¦×•×™" },
            { "english": "disease", "hebrew": "××—×œ×”" },
            { "english": "do (one's) best", "hebrew": "×œ×¢×©×•×ª ×›××™×˜×‘ ×™×›×•×œ×ª×•" },
            { "english": "emergency", "hebrew": "×—×™×¨×•×" },
            { "english": "fine", "hebrew": "×§× ×¡" },
            { "english": "health", "hebrew": "×‘×¨×™××•×ª" },
            { "english": "in case", "hebrew": "×‘××§×¨×” ×©" },
            { "english": "necessary", "hebrew": "×”×›×¨×—×™, × ×—×•×¥" },
            { "english": "obvious", "hebrew": "×‘×¨×•×¨, ××•×‘×Ÿ" },
            { "english": "one day", "hebrew": "×™×•× ××—×“" },
            { "english": "organize", "hebrew": "×œ××¨×’×Ÿ" },
            { "english": "patient (n)", "hebrew": "×—×•×œ×”" },
            { "english": "peace", "hebrew": "×©×œ×•×" },
            { "english": "pleased", "hebrew": "××¨×•×¦×”" },
            { "english": "suggest", "hebrew": "×œ×”×¦×™×¢" },
            { "english": "terrible", "hebrew": "× ×•×¨×" },
            { "english": "toothache", "hebrew": "×›××‘ ×©×™× ×™×™×" },
            { "english": "typical", "hebrew": "×˜×™×¤×•×¡×™" },
            { "english": "across", "hebrew": "××¢×‘×¨ ×œ" },
            { "english": "activity", "hebrew": "×¤×¢×™×œ×•×ª" },
            { "english": "be located in", "hebrew": "×œ×”×™×•×ª ×××•×§× ×‘" },
            { "english": "be made of", "hebrew": "×œ×”×™×•×ª ×¢×©×•×™ ×" },
            { "english": "carry", "hebrew": "×œ×©××ª, ×œ×¡×—×•×‘" },
            { "english": "distance", "hebrew": "××¨×—×§" },
            { "english": "fear (n)", "hebrew": "×¤×—×“" },
            { "english": "however", "hebrew": "××•×œ×, ×¢× ×–××ª" },
            { "english": "hurt (v)", "hebrew": "×œ×¤×’×•×¢, ×œ×”×›××™×‘" },
            { "english": "in time", "hebrew": "×‘×–××Ÿ" },
            { "english": "make sure (that)", "hebrew": "×œ×•×•×“× ×©" },
            { "english": "on foot", "hebrew": "×‘×¨×’×œ" },
            { "english": "ordinary", "hebrew": "×¨×’×™×œ" },
            { "english": "path", "hebrew": "×©×‘×™×œ" },
            { "english": "piece", "hebrew": "×—×ª×™×›×”" },
            { "english": "protect", "hebrew": "×œ×”×’×Ÿ" },
            { "english": "reach", "hebrew": "×œ×”×’×™×¢" },
            { "english": "really", "hebrew": "×‘×××ª" },
            { "english": "responsibility", "hebrew": "××—×¨×™×•×ª" },
            { "english": "simple", "hebrew": "×¤×©×•×˜" },
            { "english": "stay (v)", "hebrew": "×œ×”×™×©××¨" },
            { "english": "suddenly", "hebrew": "×¤×ª××•×" },
            { "english": "themselves", "hebrew": "×¢×¦××" },
            { "english": "be willing to", "hebrew": "×œ×”×™×•×ª ××•×›×Ÿ ×œ" },
            { "english": "closing time", "hebrew": "×©×¢×ª ×¡×’×™×¨×”" },
            { "english": "definitely", "hebrew": "×‘×”×—×œ×˜" },
            { "english": "diploma", "hebrew": "×ª×¢×•×“×”" },
            { "english": "involve", "hebrew": "×œ×›×œ×•×œ, ×œ×¢×¨×‘" },
            { "english": "by", "hebrew": "×œ×™×“, ×¢×œ ×™×“×™" },
            { "english": "local", "hebrew": "××§×•××™" },
            { "english": "open (v)", "hebrew": "×œ×¤×ª×•×—" },
            { "english": "opportunity", "hebrew": "×”×–×“×× ×•×ª" }
        ];

        let vocabulary = EMBEDDED_VOCABULARY;

        // ============================================
        // ×˜×¢×™× ×” ××•×˜×•××˜×™×ª ×¢× ×ª××™×›×” ×‘×©×™×¢×•×¨×™×
        // ============================================
        async function loadVocabulary() {
            // Check if LessonManager exists
            if (typeof LessonManager !== 'undefined') {
                await LessonManager.init(EMBEDDED_VOCABULARY);
                LessonManager.createLessonSelector('lessonSelector', onLessonChange);
                initializeGame();
            } else {
                // Fallback: load directly without lesson support
                try {
                    const response = await fetch('vocabulary.json');
                    if (response.ok) {
                        const data = await response.json();
                        
                        // Check if new structure (with lessons array)
                        if (data.lessons && Array.isArray(data.lessons)) {
                            vocabulary = data.lessons.flatMap(lesson => lesson.words);
                            console.log('âœ… Vocabulary loaded from JSON (all lessons)');
                        } else {
                            vocabulary = data;
                            console.log('âœ… Vocabulary loaded from JSON');
                        }
                    } else {
                        console.log('â„¹ï¸ Using embedded vocabulary');
                    }
                } catch (error) {
                    console.log('â„¹ï¸ Using embedded vocabulary');
                }
                initializeGame();
            }
        }
        
        function onLessonChange(lesson) {
            // Reset game state
            correctCount = 0;
            wrongCount = 0;
            wrongCards = [];
            currentIndex = 0;
            
            document.getElementById('correctScore').textContent = '0';
            document.getElementById('wrongScore').textContent = '0';
            
            // Reinitialize with new lesson
            initializeGame();
        }

        function initializeGame() {
            if (typeof LessonManager !== 'undefined') {
                vocabulary = LessonManager.getCurrentVocabulary();
            }
            cards = shuffleArray([...vocabulary]);
            currentIndex = 0;
            displayCard();
        }

        let currentIndex = 0;
        let cards = [];
        let correctCount = 0;
        let wrongCount = 0;
        let wrongCards = []; // Track cards that were marked as wrong
        let isRetryMode = false;

        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }

        // Initialize with shuffled cards
        cards = shuffleArray([...vocabulary]);

        function displayCard() {
            const card = cards[currentIndex];
            const cardElement = document.getElementById('card');
            
            // Force remove flipped class immediately
            cardElement.classList.remove('flipped');
            
            // Small delay to ensure DOM updates, then set content
            setTimeout(() => {
                document.getElementById('question').textContent = card.english;
                document.getElementById('answer').textContent = card.hebrew;
                document.getElementById('progress').textContent = `×§×œ×£ ${currentIndex + 1} ××ª×•×š ${cards.length}`;
            }, 0);
        }

        function flipCard() {
            document.getElementById('card').classList.toggle('flipped');
        }

        function markAnswer(isCorrect) {
            if (isCorrect) {
                correctCount++;
                document.getElementById('correctScore').textContent = correctCount;
            } else {
                wrongCount++;
                document.getElementById('wrongScore').textContent = wrongCount;
                
                // Track wrong card if not already tracked
                const currentCard = cards[currentIndex];
                if (!wrongCards.find(c => c.english === currentCard.english)) {
                    wrongCards.push(currentCard);
                }
            }
            
            // First, flip back to English if card is flipped
            const cardElement = document.getElementById('card');
            if (cardElement.classList.contains('flipped')) {
                cardElement.classList.remove('flipped');
                
                // Wait for flip animation to complete, then move to next card
                setTimeout(() => {
                    nextCard();
                }, 300); // Half of the 0.6s flip animation
            } else {
                // If already showing English, move to next card immediately
                nextCard();
            }
        }

        function nextCard() {
            currentIndex++;
            if (currentIndex >= cards.length) {
                showFinalScreen();
            } else {
                displayCard();
            }
        }

        function shuffleCards() {
            // Shuffle the current cards array
            cards = shuffleArray(cards);
            currentIndex = 0;
            displayCard();
        }

        function showFinalScreen() {
            // Hide game area
            document.querySelector('.card-container').style.display = 'none';
            document.querySelector('.progress').style.display = 'none';
            document.getElementById('answerButtons').style.display = 'none';
            document.querySelector('.controls').style.display = 'none';
            document.querySelector('.hint').style.display = 'none';
            
            // Show final screen
            document.getElementById('finalScreen').style.display = 'block';
            document.getElementById('finalCorrect').textContent = correctCount;
            document.getElementById('finalWrong').textContent = wrongCount;
            
            // Show retry button if there are wrong cards
            if (wrongCards.length > 0) {
                const retryBtn = document.getElementById('retryWrongBtn');
                retryBtn.style.display = 'inline-block';
                retryBtn.textContent = `ğŸ’ª ×ª×¨×’×œ ×¨×§ ××™×œ×™× ×©×˜×¢×™×ª×™ (${wrongCards.length} ××™×œ×™×)`;
            }
        }

        function restartGame() {
            // Reset everything and shuffle
            cards = shuffleArray([...vocabulary]);
            correctCount = 0;
            wrongCount = 0;
            wrongCards = [];
            isRetryMode = false;
            currentIndex = 0;
            
            document.getElementById('correctScore').textContent = '0';
            document.getElementById('wrongScore').textContent = '0';
            
            // Show game area
            document.querySelector('.card-container').style.display = 'block';
            document.querySelector('.progress').style.display = 'block';
            document.getElementById('answerButtons').style.display = 'flex';
            document.querySelectorAll('.controls').forEach(el => el.style.display = 'flex');
            document.querySelector('.hint').style.display = 'block';
            document.getElementById('finalScreen').style.display = 'none';
            
            displayCard();
        }

        function retryWrongCards() {
            // Use only wrong cards and shuffle them
            cards = shuffleArray([...wrongCards]);
            correctCount = 0;
            wrongCount = 0;
            isRetryMode = true;
            currentIndex = 0;
            
            document.getElementById('correctScore').textContent = '0';
            document.getElementById('wrongScore').textContent = '0';
            
            // Show game area
            document.querySelector('.card-container').style.display = 'block';
            document.querySelector('.progress').style.display = 'block';
            document.getElementById('answerButtons').style.display = 'flex';
            document.querySelectorAll('.controls').forEach(el => el.style.display = 'flex');
            document.querySelector('.hint').style.display = 'block';
            document.getElementById('finalScreen').style.display = 'none';
            
            displayCard();
        }

        // Keyboard navigation
        document.addEventListener('keydown', (e) => {
            if (e.key === ' ' || e.key === 'Enter') {
                e.preventDefault();
                flipCard();
            } else if (e.key === 'ArrowRight' || e.key === 'ArrowLeft') {
                e.preventDefault();
                nextCard();
            }
        });

        // Initialize game on load - automatically check for external JSON
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', loadVocabulary);
        } else {
            loadVocabulary();
        }
    </script>
</body>
</html>
